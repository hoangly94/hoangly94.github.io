(window.webpackJsonp=window.webpackJsonp||[]).push([["add-compare-dialog"],{FxnJ:function(t,e,s){},GhZA:function(t,e,s){"use strict";s.r(e);var a=s("abKS"),o=s("QwKQ"),i=s.n(o);class l extends i.a{constructor(t){t.checked=TVSettings.getBool(t.settingsKey,t.defaultValue),super(t),this.$checkbox.change((()=>{setTimeout((()=>{TVSettings.setValue(t.settingsKey,this.checked)}))}))}}var d=s("pZll"),n=s("Kxc7");s("UxRG"),s("k47Q");const c=n.enabled("secondary_series_extend_time_scale"),r=`\n\t<div class="tv-add-symbol-tab">\n\t\t<input type="text" class="tv-control-input js-add-symbol-tab-input" placeholder="${$.t("Symbol")}" autocomplete="off">\n\t\t<div class="tv-add-symbol-tab__add-symbol-overlay js-add-symbol-tab-checkbox"></div>\n\t</div>`;class b{constructor(t,e){this._chartWidgetCollection=t,this._dialog=e,this._$popup=null,this.init()}init(){if(this.$tab=$(r),this._$input=this.$tab.find(".js-add-symbol-tab-input"),this._overlayCheckbox=new l({defaultValue:!0,settingsKey:"showAddSymbolDialog.checkboxState",labelRight:$.t("Overlay the main chart"),labelAddClass:"tv-add-symbol-tab__checkbox-label",boxAddClass:"tv-add-symbol-tab__checkbox-box"}),this.$tab.find(".js-add-symbol-tab-checkbox").append(this._overlayCheckbox.$el),c){this._extendTimeScaleCheckbox=new l({defaultValue:!1,settingsKey:"showAddSymbolDialog.extendCheckboxState",labelRight:$.t("Allow extend time scale"),labelAddClass:"tv-add-symbol-tab__checkbox-label",boxAddClass:"tv-add-symbol-tab__checkbox-box"});const t=$('<div class="tv-add-symbol-tab__add-symbol-overlay"></div>');t.append(this._extendTimeScaleCheckbox.$el),this.$tab.append(t)}else this._extendTimeScaleCheckbox=null;Object(d.symbolSearchUIService)().bindToInput(this._$input,{callback:t=>{const e=this._chartWidgetCollection.activeChartWidget.value();if(e){const s=null!==this._extendTimeScaleCheckbox&&this._extendTimeScaleCheckbox.checked;e.addOverlayStudy(t,this._overlayCheckbox.checked,s)}},onPopupOpen:t=>{t.css("z-index",this._dialog.getZIndex()),this._$popup=t},onPopupClose:()=>{this._$popup=null},keepFocus:!0,clearAfterAccept:!0})}focus(){Modernizr.mobiletouch||this._$input.focus()}isClickOnTab(t){return!(!this._$popup||this._$popup[0]!==t.target&&!this._$popup[0].contains(t.target))}}var p=s("jlOC"),h=s("JWMC");s("jPTo"),s.d(e,"AddCompareDialog",(function(){return _}));class _{constructor(t){this._chartWidgetCollection=t,this._$symbolSearchPopup=null,this._dialog=null}show(){if(this.isOpened())return this._dialog;null!==this._dialog&&this._dialog.destroy();const t=new a.a(this._chartWidgetCollection,this),e=new b(this._chartWidgetCollection,this),s=[];s.push({name:$.t("Compare"),page:t.$tab.addClass("tv-compare-dialog__tab-page")}),s.push({name:$.t("Add Symbol",{context:"compare_or_add_symbol_dialog"}),page:e.$tab.addClass("tv-compare-dialog__tab-page")});const o=Object(p.a)({tabs:s,width:400,tabStateSaveKey:"CompareAddDialog.tab",destroyOnClose:!0,withScroll:!1,addClass:"tv-compare-dialog",tabsScrollBoxAddClass:"tv-compare-dialog__scroll-box",tabAddClass:"tv-compare-dialog__tab",isClickOutFn:s=>{if(t.isClickOnTab(s)||e.isClickOnTab(s))return!1}});return this._dialog=o.dialog,this._dialog.on("afterClose",(()=>{Object(h.trackEvent)("GUI","Compare",t.selectedSymbols.sort().join(", "))})),this._dialog.open(),this._dialog}hide(){this.isOpened()&&this._dialog.close()}isOpened(){return this._dialog&&this._dialog.isOpened()}getZIndex(){return this._dialog.zIndex}}},UxRG:function(t,e,s){},abKS:function(t,e,s){"use strict";(function(t,a){s.d(e,"a",(function(){return n}));var o=s("pZll"),i=s("JWMC");s("UxRG"),s("b6p+"),s("frtK");const l=`\n\t<div class="tv-compare-tab">\n\t\t<input type="text" class="tv-control-input js-compare-tab-input" placeholder="${$.t("Company Comparison")}" autocomplete="off">\n\t</div>`,d=`\n\t<div class="tv-compare-tab__predefine-cell {{additionalClass}}">\n\t\t<label for="{{symbolId}}">\n\t\t\t<span class="tv-control-checkbox">\n\t\t\t\t<input class="tv-control-checkbox__input js-predefine-checkbox" type="checkbox" id="{{symbolId}}">\n\t\t\t<span class="tv-control-checkbox__box tv-compare-tab__checkbox-box">${s("aLUT")}</span>\n\t\t\t<span class="tv-control-checkbox__ripple js-ripple"></span>\n\t\t\t</span>\n\t\t\t<span class="tv-control-checkbox__label tv-compare-tab__checkbox-label">{{label}}</span>\n\t\t</label>\n\t</div>`;class n{constructor(e,s){this.selectedSymbols=[],this._chartWidgetCollection=e,this._dialog=s,this._$popup=null,this._predefines={},this._symbolAlias={},this._isBovespa=t.enabled("bovespa_widget"),this._predefines=this._chartWidgetCollection.activeChartWidget.value().compareSymbols()||[],this.init()}_addCompareSymbol(t,e,s){const a=this._chartWidgetCollection.activeChartWidget.value();if(a)return this.selectedSymbols.push(t),a.addCompareStudy(t).then((function(t){const e=null!==t;return e&&Object(i.trackEvent)("GUI","Add Compare"),e}))}removeCompareSymbol(t){const e=this._chartWidgetCollection.activeChartWidget.value();if(!e)return;const s=e.model();s&&(this.selectedSymbols=this.selectedSymbols.filter((e=>e!==t)),s.dataSources().forEach((e=>{if(e._metaInfo&&"Compare@tv-basicstudies"===e._metaInfo.id){const a=e.properties().inputs.symbol.value();(a===t||this._symbolAlias[a]&&this._symbolAlias[a]===t)&&s.removeSource(e)}})))}init(){const t=this._chartWidgetCollection.activeChartWidget.value();if(!t)return;const e=t.model();if(!e)return;const s=e.dataSources();this.$tab=$(l),this._initSymbolSearch(),this._createPredefinesList();const a=this.$tab.find(".js-compare-tab-predefines");a.find(".js-predefine-checkbox").attr("checked",!1),this._predefines.forEach((({symbol:t})=>{const e=this._symbolToId(t),o=a.find("#"+e);s.forEach((e=>{if(e._metaInfo&&"Compare@tv-basicstudies"===e._metaInfo.id){const s=e.properties().inputs.symbol.value();(s===t||this._symbolAlias[s]&&this._symbolAlias[s]===t)&&(o.attr("checked",!0),this.selectedSymbols.push(s))}}))}))}_initSymbolSearch(){this._$input=this.$tab.find(".js-compare-tab-input"),Object(o.symbolSearchUIService)().bindToInput(this._$input,{callback:t=>this._addCompareSymbol(t),onPopupOpen:t=>{t.css("z-index",this._dialog.getZIndex()),this._$popup=t},onPopupClose:()=>{this._$popup=null},keepFocus:!0,clearAfterAccept:!0})}_createPredefinesList(){const t=this;function e(e){setTimeout((()=>{$(this).is(":checked")?t._addCompareSymbol(e.data.symbol).then((t=>{t||$(this).attr("checked",!1)})):t.removeCompareSymbol(e.data.symbol)}))}const s=$('<div class="tv-compare-tab__predefines js-compare-tab-predefines"></div>');this._predefines.forEach((({symbol:t,title:o})=>{const i=$(a.render(d,{symbolId:this._symbolToId(t),label:o,additionalClass:this._isBovespa?"tv-compare-tab__predefine-cell--wide":""}));i.find(".js-predefine-checkbox").change({symbol:t},e),i.appendTo(s)})),s.appendTo(this.$tab)}_symbolToId(t){return t.replace(/[^a-z0-9]/gi,"_")}focus(){Modernizr.mobiletouch||this._$input.focus()}isClickOnTab(t){return!(!this._$popup||this._$popup[0]!==t.target&&!this._$popup[0].contains(t.target))}}}).call(this,s("Kxc7"),s("nbsC"))},frtK:function(t,e,s){},jPTo:function(t,e,s){},jlOC:function(t,e,s){"use strict";(function(t){s.d(e,"a",(function(){return l}));var a=s("pIOw"),o=s("YDhE");s("FxnJ");const i={tabs:[]};function l(e){e=$.extend({},i,e);const s=$(t.render('<div class="tv-dialog__section tv-dialog__section--title tv-tabbed-dialog__header js-close-button-place" tabindex="-1"><div class="tv-tabs tv-tabbed-dialog__tabs js-dialog__drag">{{#tabs}}<div class="tv-tabs__tab">{{name}}</div>{{/tabs}}</div>{{#customControls}}<div class="js-custom-controls tv-tabbed-dialog__custom-controls {{#customControlsAddClass}}{{customControlsAddClass}}{{/customControlsAddClass}}"></div>{{/customControls}}<div class="tv-tabbed-dialog__bottom-border"></div></div>{{>additionalHeaderContent}}',{tabs:e.tabs,customControls:e.customControls,customControlsAddClass:e.customControlsContainerAddClass},{additionalHeaderContent:e.additionalHeaderContent}));let l=$('<div class="tv-tabbed-dialog__pages-container"></div>');const d=l;e.contentAddClass&&l.addClass(e.contentAddClass),!1!==e.withScroll&&(l=$('<div class="js-dialog__scroll-wrap tv-dialog__scroll-wrap">').append(d.addClass("tv-dialog__scroll-wrap-inner")));const n=$('<div class="tv-tabbed-dialog">').append(s).append(l);if(e.customControls&&s.find(".js-custom-controls").append(e.customControls),!0!==e.doNotCreatePages)for(let t=0;t<e.tabs.length;++t)d.append($('<div class="tv-tabbed-dialog__tab-page">').append(e.tabs[t].page));const c=e.tabStateSaveKey,r=e.activeTab,b=e.tabsScrollBoxAddClass,p=e.tabAddClass;delete e.tabs,delete e.activeTab,delete e.customControls,delete e.tabStateSaveKey,delete e.customControlsContainerAddClass,delete e.tabsScrollBoxAddClass,delete e.tabAddClass,e.closeButtonAddClass="tv-tabbed-dialog__close",e.contentWrapTemplate=n;const h=Object(o.createDialog)(e),_=new a.a(s.find(".tv-tabs").get(0),d.get(0),{addLeftArrowsClass:"tv-tabbed-dialog__tabs-arrow-left",addRightArrowsClass:"tv-tabbed-dialog__tabs-arrow-right",addScrollBoxClass:b,tabClass:p,saveTab:c,activeTab:r});return h.on("afterOpen",(()=>{_.setActivePage(_.index(),!0,!0)})),{dialog:h,tabs:_}}}).call(this,s("nbsC"))},k47Q:function(t,e,s){}}]);