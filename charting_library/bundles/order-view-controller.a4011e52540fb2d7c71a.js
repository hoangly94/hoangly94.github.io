(window.webpackJsonp=window.webpackJsonp||[]).push([["order-view-controller"],{"+AwB":function(t,e,i){"use strict";var s=i("rRE7"),r=i("PIcZ"),o=i("SUh3"),n=i("H9Zw"),u=i("z6YP");e.startWith=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return function(e){var i=t[t.length-1];u.isScheduler(i)?t.pop():i=null;var a=t.length;return 1===a?n.concat(new r.ScalarObservable(t[0],i),e):a>1?n.concat(new s.ArrayObservable(t,i),e):n.concat(new o.EmptyObservable(i),e)}}},"+EyI":function(t,e,i){"use strict";var s=i("NVK1");e.map=function(t,e){return s.map(t,e)(this)}},"/Trf":function(t,e,i){"use strict";e.isPromise=function(t){return t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}},"0PrS":function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=i("rfFC");e.filter=function(t,e){return function(i){return i.lift(new o(t,e))}};var o=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new n(t,this.predicate,this.thisArg))},t}(),n=function(t){function e(e,i,s){t.call(this,e),this.predicate=i,this.thisArg=s,this.count=0}return s(e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},e}(r.Subscriber)},"10Uv":function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=function(t){function e(e,i){t.call(this,e,i),this.scheduler=e,this.work=i}return s(e,t),e.prototype.schedule=function(e,i){return void 0===i&&(i=0),i>0?t.prototype.schedule.call(this,e,i):(this.delay=i,this.state=e,this.scheduler.flush(this),this)},e.prototype.execute=function(e,i){return i>0||this.closed?t.prototype.execute.call(this,e,i):this._execute(e,i)},e.prototype.requestAsyncId=function(e,i,s){return void 0===s&&(s=0),null!==s&&s>0||null===s&&this.delay>0?t.prototype.requestAsyncId.call(this,e,i,s):e.flush(this)},e}(i("1Re5").AsyncAction);e.QueueAction=r},"1Re5":function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=i("tSeh"),o=function(t){function e(e,i){t.call(this,e,i),this.scheduler=e,this.pending=!1,this.work=i}return s(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t,this.pending=!0;var i=this.id,s=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(s,i,e)),this.delay=e,this.id=this.id||this.requestAsyncId(s,this.id,e),this},e.prototype.requestAsyncId=function(t,e,i){return void 0===i&&(i=0),r.root.setInterval(t.flush.bind(t,this),i)},e.prototype.recycleAsyncId=function(t,e,i){if(void 0===i&&(i=0),null!==i&&this.delay===i&&!1===this.pending)return e;r.root.clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var i=!1,s=void 0;try{this.work(t)}catch(t){i=!0,s=!!t&&t||new Error(t)}if(i)return this.unsubscribe(),s},e.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,i=e.actions,s=i.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==s&&i.splice(s,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},e}(i("C7Jb").Action);e.AsyncAction=o},"1ouX":function(t,e,i){"use strict";var s=i("10Uv"),r=i("9zIo");e.queue=new r.QueueScheduler(s.QueueAction)},"22vd":function(t,e,i){"use strict";e.identity=function(t){return t}},"35Wn":function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=function(t){function e(){t.apply(this,arguments)}return s(e,t),e.prototype.notifyNext=function(t,e,i,s,r){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(i("rfFC").Subscriber);e.OuterSubscriber=r},"3bpA":function(t,e,i){"use strict";i.r(e);var s=i("Vdly"),r=i("PT1i"),o=i("Eyy1"),n=i("Kxc7"),u=i("hY0g"),a=i.n(u),l=i("YFKU"),c=(i("xDhC"),i("G7k4"),i("MSNS"),i("mPU7"),i("fjAU"),i("4c1C")),h=i("nDsj"),d=i("ogJP"),p=i("e3/o"),b=i("en3B"),_=i("aIyQ"),f=i.n(_);const v=window.t("Long"),y=window.t("Short");class m{constructor(t,e,i,s,r,o,u,l,c,h,d){this.description="",this.isTradable=!0,this._pinButtonClicked=new f.a,this._backButtonClicked=new f.a,this._cancelButtonClicked=new f.a,this._closeButtonClicked=new f.a,this._onStatusChanged=()=>{this.hasBackButton.setValue(this._hasBackButton()),this.hasCloseButton.setValue(n.enabled("order_panel_close_button")),this.hasCancelButton.setValue(this._hasCancelButton()),this.description=this._text(),this.title=this._title()},this._onQuotes=t=>{this.hasDelayedWarning.setValue(Boolean(t.isDelayed))},this._data=h,this._symbol=t,this._formatter=d,this._brokerName=e,this.status=s,this._mode=i,this.type=r,this._existingOrder=o,this.isTradable=u,this.ticketCanBePanel=c,this.hasBackButton=new a.a(this._hasBackButton()),this.hasCloseButton=new a.a(n.enabled("order_panel_close_button")),this.hasCancelButton=new a.a(!1),this.hasDelayedWarning=new a.a(!1),this.title=this._title(),this.description=this._text(),this.status.subscribe(this._onStatusChanged),this._mode.subscribe(this._onStatusChanged),l&&(this._quotesSubscription=l.subscribe(this._onQuotes))}unsubscribe(){this._mode.unsubscribe(this._onStatusChanged),this.status.unsubscribe(this._onStatusChanged),this._quotesSubscription&&this._quotesSubscription.unsubscribe()}showCancelButton(){this.hasCancelButton.setValue(!0)}hideCancelButton(){this.hasCancelButton.setValue(!1)}back(){this._backButtonClicked.fire()}pin(){this._pinButtonClicked.fire()}cancel(){this._cancelButtonClicked.fire()}close(){this._closeButtonClicked.fire()}pinButtonClicked(){return this._pinButtonClicked}backButtonClicked(){return this._backButtonClicked}cancelButtonClicked(){return this._cancelButtonClicked}closeButtonClicked(){return this._closeButtonClicked}_hasBackButton(){return!(this._mode.value()!==b.g.Panel||!this._existingOrder&&2!==this.type&&this.status.value()!==b.h.Preview)}_hasCancelButton(){return this._mode.value()===b.g.Panel&&this.status.value()===b.h.Active&&!this._existingOrder&&2!==this.type}_title(){return this.status.value()===b.h.Preview?window.t("Order confirmation"):this._symbol}_text(){if(this.status.value()===b.h.Preview)return"";if(this._existingOrder&&this._data&&this._formatter){if(2===this.type){const t=this._data.side,e=this._data.qty,i=this._formatter.format(this._data.price||this._data.avgPrice||this._data.limitPrice);return", "+(1===t?v:y)+" "+e+" @ "+i}return", "+window.t("order")+" "+this._data.id}return this._brokerName?", "+this._brokerName:""}}var P=i("0rc0");class g{constructor(t,e,i,s,r,o){this.quotes=new a.a({ask:" ",bid:" "}),this.numericQuotes=new a.a,this.baseCurrency=null,this.onControlFocused=new f.a,this.id=Object(p.randomHashN)(6),this._waitQuotesTimeout=null,this._priceFormatter=e,this._spreadFormatter=i,this._quotes=t,this.baseCurrency=o,this.side=new a.a(s),this.status=r,this._subcsription=Object(P.t)(this.side),this.$value=this._subcsription.subject}subscribe(){return this._waitQuotesTimeout=setTimeout((()=>this.quotes.setValue({})),5e3),this._quotes.subscribe((t=>{this.quotes.setValue(this._generateText(t)),this.numericQuotes.setValue(t),this._waitQuotesTimeout&&(clearTimeout(this._waitQuotesTimeout),this._waitQuotesTimeout=null)}))}unsubscribe(){this._subcsription.unsubscribe(),this._waitQuotesTimeout&&(clearTimeout(this._waitQuotesTimeout),this._waitQuotesTimeout=null)}_generateText(t){const e={},i=Object(P.l)(t),s=Object(P.m)(t);return e.ask=this._priceFormatter.format(i),e.bid=this._priceFormatter.format(s),e.spread=Object(d.isNumber)(t.spread)?this._spreadFormatter.format(t.spread):this._priceFormatter.format(i-s),e}}i("JwtW"),i("4XzM");var w=i("ivNn"),S=i("QfUd"),O=i("VVyh"),k=i("0W4x");const C=window.t("Order price is not appropriate for this order type/direction."),M=window.t("Order price is too close to the market price. It can lead to placing wrong order type due to specifics of the order placement in {brokerTitle}");function V(t,e){return Math.abs(t-e)>t/2}class j{constructor(t,e,i,s,r,o,n,u,l,d,_,v,y,m){this.id=Object(p.randomHashN)(6),this.price=new a.a(null),this.displayPrice=new a.a(""),this.relativePrice=new S.a(null,P.g),this.priceError=new a.a,this.quotes=new S.a({ask:0,bid:0,last:0},P.g),this.side=new a.a,this.step=new a.a,this.error=new S.a({res:!1},P.g),this.onControlFocused=new f.a,this.$value=new h.BehaviorSubject(null),this._controlError=new h.BehaviorSubject(!1),this._syncPrice=null,this._symbolType="",this._priceRules=[],this.setControlError=t=>{this._controlError.next(t)},this._isPriceRules=t=>"limitPriceDistance"===t.id||"stopPriceDistance"===t.id,this._updateFocusIfNeeded=()=>{1!==this.focusedControl.value()||!this.isRelativePriceControlHidden&&this._settings.value().showRelativePriceControl||this.focusedControl.setValue(0)},this.side.setValue(e.getValue()||1),this._instrumentInfo=i,this.status=s,this.orderType=n,this._isLimitPrice=u,this._settings=l,this._settings.subscribe(this._updateFocusIfNeeded),this.isRelativePriceControlHidden=this._roundToStepRequired(),this._setStep(),this.formatter=o,this.orderWidgetStat=_,this.supportStopOrdersInBothDirections=!0===m;const g=y||this.isRelativePriceControlHidden||!this._settings.value().showRelativePriceControl;this.focusedControl=new a.a(g?0:1),this.modifiedAbsolutePriceControlStat=null!==_?()=>_.setPriceControlModifiedProperty(b.j.Absolute):()=>{},this.modifiedRelativePriceControlStat=null!==_?()=>_.setPriceControlModifiedProperty(b.j.Relative):()=>{},this.displayPrice.setValue(this.formatter.format(0)),void 0!==r&&(this.forceAbsolutePriceUpdate(r,!0),this.$value.next(this.price.value())),this._symbolType=i.type||"",this._quotes=t,this._side=e,this._priceSubscription=Object(P.t)(this.price),this._orderTypeSubscription=Object(P.t)(this.orderType),this._orderTypeSubj=this._orderTypeSubscription.subject,this._resultSubscription=c.Observable.combineLatest(this._priceSubscription.subject,this._quotes,this._side,this._orderTypeSubscription.subject,this._controlError).subscribe((([t,e,i,s,r])=>{const o=Object(P.p)(i,e),n="forex"===this._symbolType,u=null!==t&&null!==s&&2!==s?function(t,e,i,s,r,o,n,u,a,l){const c=t<0||t>100*e||function(t,e,i,s,r,o){return 1===i?1===s?t>e&&V(e,t):t<e&&V(e,t):!!(3===i&&!o||4===i&&r)&&(1===s?t<e:t>e)}(t,e,i,s,r,u);return o&&!l||!1!==Object(P.r)(t,a)?{res:c,severity:"error",msg:c?C:void 0}:{res:!0,msg:window.t("Order price should be a multiple of {minTick}").format({minTick:n.format(a)})}}(t,o,s,i,!this._isLimitPrice,n,this.formatter,this.supportStopOrdersInBothDirections,this.step.value(),this._roundToStepRequired()):{res:!1},a=null!==t?this._checkPriceWarning(t,e):{res:!1},l=this.status.value()!==b.h.Wait,c=u.res||r||a.res,h=u.res||r?"error":"warning",d=r?void 0:u.res?u.msg:a.msg;this.error.setValue({res:!!l&&c,severity:h,msg:l?d:void 0}),this.$value.next(u.res||r?null:t)})),this._pipSize=i.pipSize,this._priceRules=(v||[]).filter(this._isPriceRules),this._brokerTitle=d}onAbsolutePriceSelected(t){let e,i;e=this.formatter.parse?this.formatter.parse(t):{res:!1,error:"Formatter does not support parse"},e.res?(this.price.setValue(e.value),this.displayPrice.setValue(t)):this.displayPrice.setValue(t),i=this._isLimitPrice&&4===this.orderType.value()&&null!==this._syncPrice?this._syncPrice:this._getQuotesBySide(this.side.value());const s={base:this._getBase(this.side.value(),this.orderType.value()),offset:this.calcOffset(e.res?e.value:0,i,this.step.value())};this.relativePrice.setValue(s)}onRelativePriceSelected(t){if(this.isRelativePriceControlHidden||!this._settings.value().showRelativePriceControl)return;let e;if(this.relativePrice.setValue(t),null===t)e=0;else if("ask"===t.base)e=this.quotes.value().ask+this.step.value()*t.offset;else if("bid"===t.base)e=this.quotes.value().bid+this.step.value()*t.offset;else{let i;i=this._isLimitPrice&&4===this.orderType.value()&&null!==this._syncPrice?this._syncPrice:this._getQuotesBySide(this.side.value()),e=i+this.step.value()*t.offset}this._checkOutOfRange(this.quotes.value(),e)&&(e=this._getQuotesBySide(this.side.value()),this.relativePrice.setValue({base:this._getBase(this.side.value(),this.orderType.value()),offset:0}));const i=this.formatter.format(Object(w.fixComputationError)(e));this.price.setValue(Object(O.d)(i,this.formatter,e)),this.displayPrice.setValue(i)}subscribe(){return c.Observable.combineLatest(this._side,this._quotes,this._orderTypeSubj).subscribe((([t,e,i])=>{this.orderType.setValue(i),this.isRelativePriceControlHidden=this._roundToStepRequired(),this._setStep(),(this._isLimitPrice&&4!==i||!1===this._isLimitPrice||this.isRelativePriceControlHidden)&&(this._updateAbsolutePriceOnQuotes(t,e),this._updateRelativePriceOnQuotes(t,e,i)),this.quotes.setValue({ask:Object(P.l)(e),bid:Object(P.m)(e),last:Object(P.o)(e)}),this.side.setValue(t),this.orderType.setValue(i)}))}unsubscribe(){this._priceSubscription.unsubscribe(),this._orderTypeSubscription.unsubscribe(),this._resultSubscription.unsubscribe(),this._settings.unsubscribe(this._updateFocusIfNeeded)}forcePricesUpdate(t){this.focusedControl.setValue(this._settings.value().showRelativePriceControl&&!this.isRelativePriceControlHidden?1:0),this.forceAbsolutePriceUpdate(t),this.forceRelativePriceUpdate()}forceAbsolutePriceUpdate(t,e=!1){if(null===t)return;const i=this._roundToStepRequired()||e,s=this._getPriceType();t=i?Object(k.k)(t,this.step.value(),s,this.side.value()):t,this.price.setValue(t),this.displayPrice.setValue(this.formatter.format(t))}forceRelativePriceUpdate(){const t=this._getOffsetFromAbsolutePrice(this.price.value(),this.side.value(),this.quotes.value()),e={base:this._getBase(this.side.value(),this.orderType.value()),offset:t};this.onRelativePriceSelected(e)}forceStopLimitRelativePriceUpdate(){const t={base:"stop",offset:this.side.value()};this.onRelativePriceSelected(t)}syncWithPrice(t){const e=null!==t?t:0;this._syncPrice=e;const i=this.price.value(),s=null!==i?i:0,r=this.calcOffset(s,e,this.step.value());if(0===this.focusedControl.value()){const t={base:"stop",offset:r};this.relativePrice.setValue(t)}else{const t=this.relativePrice.value(),i=e+(null!==t?t.offset:0)*this.step.value();this.forceAbsolutePriceUpdate(i)}}calcOffset(t,e,i){return Math.round((t-e)/i)}_checkOutOfRange(t,e){const i=null!==e&&e>=0,s=null!==e&&e<=100*Object(P.p)(this.side.value(),t);return!i||!s}_checkPriceWarning(t,e){const i=this._priceRules.find((i=>this._isDistanceRuleViolated(t,e,i)));return i?{res:!0,severity:i.severity,msg:M.format({brokerTitle:this._brokerTitle})}:{res:!1,msg:void 0}}_isDistanceRuleViolated(t,e,i){if("limitPriceDistance"===i.id&&!this._isLimitPrice||"stopPriceDistance"===i.id&&this._isLimitPrice)return!1;const s=this._side.getValue(),r=1===s,o=Object(P.p)(s,e);let n=null;return r&&"buyDirectionPips"in i.options&&(n=i.options.buyDirectionPips),!r&&"sellDirectionPips"in i.options&&(n=i.options.sellDirectionPips),null!==n&&Math.abs(o-t)<n*this._pipSize}_getBase(t,e){return 4===e&&!0===this._isLimitPrice?"stop":1===t?"ask":"bid"}_getQuotesBySide(t){return 1===t?this.quotes.value().ask:this.quotes.value().bid}_getOffsetFromAbsolutePrice(t,e,i){const s=1===e?Object(P.l)(i):Object(P.m)(i);return this.calcOffset(null!==t?t:s,s,this.step.value())}_getOffsetFromRelativePrice(){const t=this.relativePrice.value();return null!==t?t.offset:0}_updateAbsolutePriceOnQuotes(t,e){const i=Object(P.p)(t,e);if(null===this.price.value())this.forceAbsolutePriceUpdate(i);else if(1===this.focusedControl.value()){const t=this._getOffsetFromRelativePrice();this.forceAbsolutePriceUpdate(Object(w.fixComputationError)(i+t*this.step.value()))}}_updateRelativePriceOnQuotes(t,e,i){if(!this.isRelativePriceControlHidden&&this._settings.value().showRelativePriceControl&&(null===this.relativePrice.value()||0===this.focusedControl.value()||this.side.value()!==t||this.orderType.value()!==i)){let s;s=this.side.value()===t?4===i&&null===this.relativePrice.value()?t:this._getOffsetFromAbsolutePrice(this.price.value(),t,e):1===this.focusedControl.value()?0:4===i?t:-this._getOffsetFromRelativePrice();const r={base:this._getBase(t,i),offset:s};this.relativePrice.setValue(r)}}_getPriceType(){const t=this.orderType.value();return 1===t||4===t&&this._isLimitPrice?1:2}_setStep(){const t=this._getPriceType();1===t&&void 0!==this._instrumentInfo.limitPriceStep?this.step.setValue(this._instrumentInfo.limitPriceStep):2===t&&void 0!==this._instrumentInfo.stopPriceStep?this.step.setValue(this._instrumentInfo.stopPriceStep):this.step.setValue(this._instrumentInfo.minTick||this._instrumentInfo.pipSize)}_roundToStepRequired(){const t=this._getPriceType(),e=this._instrumentInfo.minTick||this._instrumentInfo.pipSize;return 2===t&&void 0!==this._instrumentInfo.stopPriceStep?this._instrumentInfo.stopPriceStep!==e:1===t&&void 0!==this._instrumentInfo.limitPriceStep&&this._instrumentInfo.limitPriceStep!==e}}i("HbRj");var T=i("m6W+"),I=i("kcTO"),B=i("jjUP");class x{constructor(t,e,i,s,r,o,n,u,l,d,p){this.formatter=new T.a,this.riskInCurrencyFormatter=new I.PriceFormatter(100),this.riskInPercentFormatter=new I.PriceFormatter(100),this.isRiskAvailable=new a.a(!1),this.focusedControl=new a.a(null),this.riskStep=.01,this.error=new S.a({res:!1},P.g),this.onControlFocused=new f.a,this.$value=new h.BehaviorSubject(null),this._focusSubscription=Object(P.t)(this.focusedControl),this._focusSubj=this._focusSubscription.subject,this._controlError=new h.BehaviorSubject({res:!1}),this.setControlError=t=>{this._controlError.next({res:t})},this._updateFocusIfNeeded=t=>{const e=this.focusedControl.value(),i=1===e&&!t.showCurrencyRiskInQty,s=2===e&&!t.showPercentRiskInQty;(i||s)&&this.focusedControl.setValue(0)},this.qty=r.qty,this._lotSize=r.lotSize,this.quantity={value:new a.a(null!==n?n:this.qty.default),onModifiedCallback:()=>null!==d?d.setQtyControlModifiedProperty(b.l.Units):()=>{},calculatorUsedStat:()=>null!==d?d.setCalculatorUsedProperty():()=>{}},this._quantitySubscription=Object(P.t)(this.quantity.value),this._quantitySubj=this._quantitySubscription.subject,this.currency=o||"",this.riskInCurrency={value:new a.a(null),onModifiedCallback:()=>null!==d?d.setQtyControlModifiedProperty(b.l.RiskInCurrency):()=>{},calculatorUsedStat:()=>null!==d?d.setCalculatorUsedProperty():()=>{}},this.riskInPercent={value:new a.a(null),onModifiedCallback:()=>null!==d?d.setQtyControlModifiedProperty(b.l.RiskInPercent):()=>{},calculatorUsedStat:()=>null!==d?d.setCalculatorUsedProperty():()=>{}},this.showRiskControls=p,this._riskInCurrencySubscription=Object(P.t)(this.riskInCurrency.value),this._riskInPercentSubscription=Object(P.t)(this.riskInPercent.value),this._riskInCurrencySubj=this._riskInCurrencySubscription.subject,this._riskInPercentSubj=this._riskInPercentSubscription.subject,this.status=u,this._equity=i,this._pipValue=s,this._stopLossAvailable=t,this._stopLossPips=e,this._stopLossSubscription=this._stopLossAvailable.subscribe((t=>{this.isRiskAvailable.setValue(t),t||this.focusedControl.setValue(0)})),this._valuesSubscription=c.Observable.combineLatest(this._createQuantityObservable(),this._createRiskInCurrencyObservable(),this._createRiskInPercentObservable(),this._focusSubj).subscribe((([t,e,i,s])=>{this.quantity.value.value()===t&&this.riskInCurrency.value.value()===e&&this.riskInPercent.value.value()===i&&this.focusedControl.value()===s||this._setValuesForUnfocusedControls(s,t,e,i)})),this._resultSubscription=c.Observable.combineLatest(this._quantitySubj,this._controlError,this._focusSubj).subscribe((([t,e,i])=>{const s=Object(B.c)(this.qty,t,!0),r=e.res?e.msg:s.msg;this.error.setValue({res:s.res||e.res,msg:r}),this.$value.next(s.res||e.res||null===i?null:t)})),this.focusedControl.setValue(0),this._settings=l,this._settings.subscribe(this._updateFocusIfNeeded)}unsubscribe(){this._stopLossSubscription.unsubscribe(),this._valuesSubscription.unsubscribe(),this._resultSubscription.unsubscribe(),this._focusSubscription.unsubscribe(),this._quantitySubscription.unsubscribe(),this._riskInCurrencySubscription.unsubscribe(),this._riskInPercentSubscription.unsubscribe(),this._settings.unsubscribe(this._updateFocusIfNeeded)}_setValuesForUnfocusedControls(t,e,i,s){0!==t&&this.quantity.value.setValue(e),1!==t&&this.riskInCurrency.value.setValue(i),2!==t&&this.riskInPercent.value.setValue(s)}_createQuantityObservable(){return c.Observable.combineLatest([this._focusSubj,this._pipValue,this._quantitySubj,this._riskInCurrencySubj,this._riskInPercentSubj,this._stopLossPips,this._equity],((t,...e)=>{const[i,s,r,o,n,u]=e;switch(t){case 0:default:return s;case 1:return Object(B.e)(r,n,i,this.qty.step,this._lotSize);case 2:return Object(B.f)(o,u,n,i,this.qty.step,this._lotSize)}}))}_createRiskInCurrencyObservable(){return c.Observable.combineLatest([this._focusSubj,this._pipValue,this._quantitySubj,this._riskInCurrencySubj,this._riskInPercentSubj,this._stopLossPips,this._equity],((t,...e)=>{const[i,s,r,o,n,u]=e;switch(t){case 0:return Object(B.a)(s,n,i,this._lotSize);case 1:return r;case 2:const t=Object(B.f)(o,u,n,i,this.qty.step,this._lotSize);return Object(B.a)(t,n,i,this._lotSize);default:return Object(B.a)(s,n,i)}}))}_createRiskInPercentObservable(){return c.Observable.combineLatest([this._focusSubj,this._pipValue,this._quantitySubj,this._riskInCurrencySubj,this._riskInPercentSubj,this._stopLossPips,this._equity],((t,...e)=>{const[i,s,r,o,n,u]=e;switch(t){case 0:default:return Object(B.b)(s,n,i,u,this._lotSize);case 1:const t=Object(B.e)(r,n,i,this.qty.step,this._lotSize);return Object(B.b)(t,n,i,u,this._lotSize);case 2:return o}}))}}var L=i("cUJV");class R{constructor(t,e,i,s,r,o,n,u){this.focusedControl=new a.a(3),this.error=new S.a({res:!1},P.g),this.onControlFocused=new f.a,this.baseCurrencyCryptoBalance=new a.a(null),this.quoteCurrencyCryptoBalance=new a.a(null),this.$value=new h.BehaviorSubject(null),this._focusSubscription=Object(P.t)(this.focusedControl),this._controlError=new h.BehaviorSubject({res:!1}),this._focusSubj=this._focusSubscription.subject,this.setControlError=t=>{this._controlError.next({res:t})},this.info=t,this.status=o,this.formatter=new L.a,this.quantity={value:new a.a(null!==r?r:t.qty.default||t.qty.step),onModifiedCallback:null!==u?()=>u.setQtyControlModifiedProperty(b.l.BaseCurrency):()=>{}},this.quoteCurrencyQuantity={value:new a.a(null!==r?r:t.qty.default||t.qty.step),onModifiedCallback:null!==u?()=>u.setQtyControlModifiedProperty(b.l.QuoteCurrency):()=>{}},this.side=n,this._quoteCurrencyQuantitySubscription=Object(P.t)(this.quoteCurrencyQuantity.value),this._baseCurrencyQuantitySubscription=Object(P.t)(this.quantity.value),this._baseCurrencyQuantitySubj=this._baseCurrencyQuantitySubscription.subject,this._quoteCurrencyQuantitySubj=this._quoteCurrencyQuantitySubscription.subject,this._sideSubscription=Object(P.t)(this.side),this._sideSubj=this._sideSubscription.subject;const l=[this._baseCurrencyQuantitySubj,this._quoteCurrencyQuantitySubj,this._controlError,this._focusSubj,this._sideSubj];i&&s&&(l.push(i),l.push(s)),this._subscriptions=[c.Observable.combineLatest(this._focusSubj,e,this._baseCurrencyQuantitySubj,this._quoteCurrencyQuantitySubj).subscribe((([e,i,s,r])=>{if(4===e){if(null!==r){const e=Object(w.fixComputationError)(r/i);this.quantity.value.setValue(Object(w.fixComputationError)(Math.floor(e/t.qty.step)*t.qty.step))}}else null!==s&&this.quoteCurrencyQuantity.value.setValue(Object(w.fixComputationError)(s*i))})),c.Observable.combineLatest(l,((e,i,s,r,o,...n)=>{const[u,a]=n,l=Object(B.c)(t.qty,e),c=-1===o?this._checkBalanceError(e,u):this._checkBalanceError(i,a);this.error.setValue({res:l.res||c.res||s.res,msg:l.msg||c.msg||s.msg}),this.$value.next(l.res||c.res||s.res||null===r?null:e)})).subscribe()],i&&this._subscriptions.push(i.subscribe((t=>{this.baseCurrencyCryptoBalance.setValue(t)}))),s&&this._subscriptions.push(s.subscribe((t=>{this.quoteCurrencyCryptoBalance.setValue(t)})))}unsubscribe(){this._subscriptions.forEach((t=>t&&t.unsubscribe()))}_checkBalanceError(t,e){return null!==t&&e&&t>e.available?{res:!0,msg:B.d.balance}:{res:!1}}}function N(t,e,i,s){return Object(w.fixComputationError)((t-e)/(s*i))}function F(t,e,i,s){return e?Math.floor(Object(w.fixComputationError)(t/(i*e*(s||1)))):0}function D(t,e,i,s,r){return e?Math.floor(Object(w.fixComputationError)(t*i/(s*e*(r||1)*100))):0}function E(t,e,i,s){return Object(w.fixComputationError)(i*t*s+e)}function q(t,e,i,s){return t*i*e*(s||1)}function A(t,e,i,s,r){return i?t*s*e*(r||1)*100/i:0}i("gxrE");const $={orderStopLoss:{long:window.t("Stop loss order must be below entry price."),short:window.t("Stop loss order must be higher entry price.")},orderTakeProfit:{long:window.t("Take profit order must be above entry price."),short:window.t("Take profit order must be lower entry price.")},positionStopLoss:{long:t=>window.t("Stop loss must be below current __value__.",{value:t}),short:t=>window.t("Stop loss must be above current __value__.",{value:t})},positionTakeProfit:{long:t=>window.t("Take profit must be above current __value__.",{value:t}),short:t=>window.t("Take profit must be below current __value__.",{value:t})}},W={ask:window.t("ask"),bid:window.t("bid"),multiplyOfMinTick:window.t("Bracket price should be a multiple of {minTick}")};class Q{constructor(t,e,i,s,r,o,n,u,l,d,p,_,v,y,m,g,w,O,k,C,M){this.focusedControl=new a.a(null),this.error=new S.a({res:!1},P.g),this.onControlFocused=new f.a,this.slTypes=[b.a.StopLoss,b.a.TrailingStop],this.$value=new h.BehaviorSubject(null),this.roundToStopLimitPriceStepRequired=!1,this.showRiskControls=!0,this._errorSubj=new h.BehaviorSubject({res:!1}),this._controlError=new h.BehaviorSubject({res:!1}),this._enabledSubj=new h.BehaviorSubject(!1),this._focusSubscription=Object(P.t)(this.focusedControl),this.setControlError=t=>{this._controlError.next({res:t,msg:void 0})},this._updateFocusIfNeeded=t=>{const e=this.focusedControl.value(),i=this._supportCryptoBrackets?"showCryptoBracketsInPercent":"showBracketsInPercent",s=this._supportCryptoBrackets?"showCryptoBracketsInCurrency":"showBracketsInCurrency";(3===e&&!t[i]||2===e&&!t[s])&&this.focusedControl.setValue(0)},this.bracketType=new a.a(i);const V=null!==t;let j,T;this.enabled=new a.a(e),V&&this.focusedControl.setValue(1),this._supportCryptoBrackets=!0===M,V?(j=null,T=t):(j=null!==m?m:this._getDefaultPips(i),T=null),this.pips={value:new a.a(j),displayProps:{step:1,formatter:new I.PriceFormatter(n.pipSize!==n.minTick?10:1)},onModifiedCallback:null!==w?()=>w.setBracketControlModifiedProperty(i,b.c.Pips):()=>{}},this._priceStep=n.minTick||n.pipSize,i===b.a.StopLoss&&void 0!==n.stopPriceStep&&n.stopPriceStep!==this._priceStep?(this._priceStep=n.stopPriceStep,this.roundToStopLimitPriceStepRequired=!0):i===b.a.TakeProfit&&void 0!==n.limitPriceStep&&n.limitPriceStep!==this._priceStep&&(this._priceStep=n.limitPriceStep,this.roundToStopLimitPriceStepRequired=!0),this.price={value:new a.a(T),displayProps:{step:this._priceStep,formatter:s},onModifiedCallback:null!==w?()=>w.setBracketControlModifiedProperty(i,b.c.Price):()=>{}},this.riskInCurrency={value:new a.a(null),displayProps:{step:.01,formatter:new I.PriceFormatter(100)},onModifiedCallback:null!==w?()=>w.setBracketControlModifiedProperty(i,b.c.Money):()=>{}},this.riskInPercent={value:new a.a(null),displayProps:{step:.01,formatter:new I.PriceFormatter(100)},onModifiedCallback:null!==w?()=>w.setBracketControlModifiedProperty(i,b.c.Percent):()=>{}},this.showRiskControls=O;const B=1!==y||k===b.h.Editing;this._inputDisabled=!C&&B&&i===b.a.TrailingStop&&Boolean(m),this._labelDisabled=!C&&B&&e,this.typeSwitcherDisabled={inputDisabled:this._inputDisabled,labelDisabled:this._labelDisabled},this._pipsSubscription=Object(P.t)(this.pips.value),this._priceSubscription=Object(P.t)(this.price.value),this._riskInCurrencySubscription=Object(P.t)(this.riskInCurrency.value),this._riskInPercentSubscription=Object(P.t)(this.riskInPercent.value),this._enabledSubscription=Object(P.t)(this.enabled),this._bracketTypeSubscription=Object(P.t)(this.bracketType),this.currency=v.length>0?v:window.t("Money"),this._equity=r,this._pipValue=u,this._pipSize=n.pipSize,this._lotSize=n.lotSize,this._side=l,this._sideSign=this._side.map((t=>(i!==b.a.TakeProfit?-1:1)*t)),this._quotes=o,this._amount=d,this._parent=y,this._type=i,this._focus=this._focusSubscription.subject,this._pipsSubj=this._pipsSubscription.subject,this._priceSubj=this._priceSubscription.subject,this._riskInCurrencySubj=this._riskInCurrencySubscription.subject,this._riskInPercentSubj=this._riskInPercentSubscription.subject,this._enabledSubj=this._enabledSubscription.subject,this._bracketTypeSubj=this._bracketTypeSubscription.subject,this._orderPrice=c.Observable.combineLatest(p,_,this._bracketTypeSubj,o,this._side,((t,e,i,s,r)=>i!==b.a.TrailingStop||2!==e&&1===y?t:1===r?Object(P.m)(s):Object(P.l)(s))),this._valuesSubscription=c.Observable.combineLatest([this._enabledSubj,this._side,this._focus,this._quotes,this._createPipsObservable(),this._createPriceObservable(),this._createRiskInCurrencyObservable(),this._createRiskInPercentObservable()],((t,e,i,r,...o)=>{const[n,u,a,l]=o;if((t||null===this.riskInCurrency.value.value())&&(this.focusedControl.value()!==i||this.pips.value.value()!==n||this.price.value.value()!==u||this.riskInCurrency.value.value()!==a||this.riskInPercent.value.value()!==l)){this._setValuesForUnfocusedControls(i,n,u,a,l);let t={res:!1};t=2===this._parent?this._checkPositionError(e,n,u,r):this._checkOrderError(e,n,u),this.roundToStopLimitPriceStepRequired&&!t.res&&1===this.focusedControl.value()&&(t=function(t,e,i){return Object(P.r)(t,e)?{res:!1}:{res:!0,msg:W.multiplyOfMinTick.format({minTick:i.format(e)})}}(u,this._priceStep,s)),this._errorSubj.next(t)}})).subscribe(),this._resultSubscription=c.Observable.combineLatest(this._pipsSubj,this._errorSubj,this._controlError,this._focus,this._enabledSubj).subscribe((([t,e,i,s,r])=>{const o=i.res?i.msg:e.msg;this.error.setValue({res:e.res||i.res,msg:o}),this.$value.next(e.res||i.res||null===s||!r?null:t)})),this._settings=g,this._settings.subscribe(this._updateFocusIfNeeded)}unsubscribe(){this._focusSubscription.unsubscribe(),this._pipsSubscription.unsubscribe(),this._priceSubscription.unsubscribe(),this._riskInCurrencySubscription.unsubscribe(),this._riskInPercentSubscription.unsubscribe(),this._valuesSubscription.unsubscribe(),this._resultSubscription.unsubscribe(),this._bracketTypeSubscription.unsubscribe(),this._settings.unsubscribe(this._updateFocusIfNeeded)}readyToSubmit(){return this.enabled.value()&&null!==this.$value.getValue()&&null!==this.price.value.value()||!this.enabled.value()}_getDefaultPips(t){return t===b.a.TakeProfit?b.b.TakeProfit:b.b.StopLoss}_setValuesForUnfocusedControls(t,e,i,s,r){0!==t&&this.pips.value.setValue(e),1!==t&&this.price.value.setValue(i),2!==t&&this.riskInCurrency.value.setValue(s),3!==t&&this.riskInPercent.value.setValue(r),null===this.focusedControl.value()&&this.focusedControl.setValue(0)}_checkOrderError(t,e,i){if(e<=0||i<=0){const e=this._type===b.a.TakeProfit?$.orderTakeProfit:$.orderStopLoss;return{res:!0,msg:1===t?e.long:e.short}}return{res:!1}}_checkPositionError(t,e,i,s){const r=(this._type===b.a.TakeProfit?-1:1)*t,o=-1===t?Object(P.l)(s):Object(P.m)(s),n=-1===t?W.ask:W.bid,u=this._type===b.a.TakeProfit?$.positionTakeProfit:$.positionStopLoss;return o&&Math.sign(i-o)===r?{res:!0,msg:-1===t?u.short(n):u.long(n)}:{res:!1}}_createPipsObservable(){return c.Observable.combineLatest([this._focus,this._sideSign,this._pipValue,this._amount,this._equity,this._orderPrice,this._pipsSubj,this._priceSubj,this._riskInCurrencySubj,this._riskInPercentSubj],((t,...e)=>{const[i,s,r,o,n,u,a,l,c]=e;switch(t){case 0:default:return u;case 1:return N(a,n,i,this._pipSize);case 2:return F(l,r,s,this._lotSize);case 3:return D(c,r,o,s,this._lotSize)}}))}_createPriceObservable(){return c.Observable.combineLatest([this._focus,this._sideSign,this._pipValue,this._amount,this._equity,this._orderPrice,this._pipsSubj,this._priceSubj,this._riskInCurrencySubj,this._riskInPercentSubj],((t,...e)=>{const[i,s,r,o,n,u,a,l,c]=e,h=this._type===b.a.TakeProfit?1:2;let d,p;switch(t){case 0:default:p=E(u,n,i,this._pipSize);break;case 1:return a;case 2:d=F(l,r,s,this._lotSize),p=E(d,n,i,this._pipSize);break;case 3:d=D(c,r,o,s,this._lotSize),p=E(d,n,i,this._pipSize)}return this.roundToStopLimitPriceStepRequired?Object(k.k)(p,this._priceStep,h,i):p}))}_createRiskInCurrencyObservable(){return c.Observable.combineLatest([this._focus,this._sideSign,this._pipValue,this._amount,this._equity,this._orderPrice,this._pipsSubj,this._priceSubj,this._riskInCurrencySubj,this._riskInPercentSubj],((t,...e)=>{const[i,s,r,o,n,u,a,l,c]=e;let h;switch(t){case 0:default:return q(u,r,s,this._lotSize);case 1:return h=N(a,n,i,this._pipSize),q(h,r,s,this._lotSize);case 2:return l;case 3:return h=D(c,r,o,s,this._lotSize),q(h,r,s,this._lotSize)}}))}_createRiskInPercentObservable(){return c.Observable.combineLatest([this._focus,this._sideSign,this._pipValue,this._amount,this._equity,this._orderPrice,this._pipsSubj,this._priceSubj,this._riskInCurrencySubj,this._riskInPercentSubj],((t,...e)=>{const[i,s,r,o,n,u,a,l,c]=e;let h;switch(t){case 0:default:return A(u,r,o,s,this._lotSize);case 1:return h=N(a,n,i,this._pipSize),A(h,r,o,s,this._lotSize);case 2:return h=F(l,r,s,this._lotSize),A(h,r,o,s,this._lotSize);case 3:return c}}))}}var z=i("MiOS");class U{constructor(t,e,i,s,r){this.onControlFocused=new f.a,this.currentDuration=new S.a(t,P.g),this.durationsMetaInfo=e,this.orderType=i,this._isDurationForMarketOrders=r,this._currentDurationSubscription=Object(P.t)(this.currentDuration),this._orderTypeSubscription=Object(P.t)(this.orderType),this.$value=new h.BehaviorSubject(this._getOrderDurationByOrderType(t,i.value())),this._subscription=c.Observable.combineLatest(this._currentDurationSubscription.subject,this._orderTypeSubscription.subject).subscribe((([t,e])=>{this.$value.next(this._getOrderDurationByOrderType(t,e))})),this.onModifiedCallback=null!==s?()=>s.setDurationControlModifiedProperty():()=>{}}unsubscribe(){this._subscription.unsubscribe(),this._currentDurationSubscription.unsubscribe(),this._orderTypeSubscription.unsubscribe()}getValue(){const t=this.$value.getValue();if(null===t)return null;const e=this.durationsMetaInfo.find((e=>t.type===e.value));if(void 0===e)return null;const i={type:t.type};return(e.hasDatePicker||e.hasTimePicker)&&(i.datetime=t.datetime),i}_getOrderDurationByOrderType(t,e){if(2===e&&!this._isDurationForMarketOrders)return null;const i=Object(z.a)(e,this.durationsMetaInfo);if(0===i.length)return null;const s=i.some((e=>t.type===e.value)),r=i.find((t=>Boolean(t.default)))||i[0],o=Object(z.e)(r);return s?t:o}}const H=window.t("Modify"),Y=window.t("Modify order");class K{constructor(t,e,i,s){if(this.value=new a.a(""),this.unsubscribe=()=>{this._orderSubscription&&this._orderSubscription.unsubscribe()},i||2===t)this.value.setValue(1===t?Y:H);else{const t=Object(o.ensureDefined)(s);this._orderTypeSubsctiption=Object(P.t)(t.orderType),this._orderTypeSubj=this._orderTypeSubsctiption.subject,this._statusSubscription=Object(P.t)(e),this._statusSubj=this._statusSubscription.subject,this._orderSubscription=c.Observable.combineLatest([this._orderTypeSubj,this._statusSubj,t.orderPlacingStatus,t.side,t.quantity,t.stopPrice,t.limitPrice],((e,i,s,r,...o)=>{const[n,u,a]=o;if(i===b.h.Preview)return this.value.setValue(window.t("Send"));if(i===b.h.Wait)return s===b.i.Placed?this.value.setValue(window.t("Order sent")):this.value.setValue(window.t("Click any field to activate order placement"));const l=null!==u?t.formatter.format(u):"",c=null!==a?t.formatter.format(a):"",h=null!==n?t.quantityFormatter.format(n):"",d=1===r?P.q.buy:P.q.sell;switch(e){case 2:return this.value.setValue(d.market(h,t.symbol));case 3:return this.value.setValue(d.stop(h,t.symbol,l));case 1:return this.value.setValue(d.limit(h,t.symbol,c));case 4:return this.value.setValue(d.stopLimit(h,t.symbol,l,c))}})).subscribe()}}}const G={title:window.t("Order Info"),pipValue:window.t("Pip Value"),tradeValue:window.t("Trade Value"),total:window.t("Total"),leverage:window.t("Leverage"),lotSize:window.t("Lot Size"),reward:window.t("Reward"),risk:window.t("Risk")};class J{constructor(t,e,i,s,r,o,n,u,l,c,h,d){this._availableMargin=new a.a(0),this._usedMargin=new a.a(0),this._infoTableData=new S.a({rows:[]},P.g),this._tpRiskInCurrencySubscription=null,this._tpRiskInPercentSubscription=null,this._slRiskInCurrencySubscription=null,this._slRiskInPercentSubscription=null,this._riskFormatter=new I.PriceFormatter(100),this._marginAvailable$=t,this._qty$=e,this._pipValue$=s,this._side$=o,this._type=l.type,this._minTick=l.minTick,this._currency=i,this._marginRate=l.marginRate,this._hasMarginMeter=d&&void 0!==this._marginRate,this._price$=r,this._showTotalInsteadOfTradeValue=n,this._showRiskControls=u,this._leverage=l.leverage,this._lotSize=l.lotSize,this._symbolPipSize=l.pipSize,this._pipValueForCurrentQuantity=0,this._tradeValue=0,c&&h&&(this._tpRiskInCurrencySubscription=Object(P.t)(c.riskInCurrency),this._tpRiskInPercentSubscription=Object(P.t)(c.riskInPercent),this._slRiskInCurrencySubscription=Object(P.t)(h.riskInCurrency),this._slRiskInPercentSubscription=Object(P.t)(h.riskInPercent))}subscribe(){const t=[this._price$,this._pipValue$,this._side$,this._qty$],e=[c.Observable.combineLatest(t,((t,e,i,s,...r)=>{const[o,n,u,a,l,c]=r;this._pipValueForCurrentQuantity=Object(P.b)(s,e,this._lotSize),this._tradeValue="crypto"===this._type?(null!==s?s:0)*t:Object(P.c)(s,t,e,this._symbolPipSize,this._lotSize),this._usedMargin.setValue(Object(P.d)(this._tradeValue,this._marginRate));const h=[],d=Object(P.i)(this._leverage,this._marginRate);if(null!==d&&h.push({title:G.leverage,value:d}),"number"==typeof this._lotSize&&Number.isFinite(this._lotSize)&&h.push({title:G.lotSize,value:""+this._lotSize}),this._showRiskControls&&"crypto"!==this._type&&Number.isFinite(this._pipValueForCurrentQuantity)&&h.push({title:G.pipValue,value:`${this._currency} ${Object(P.j)(this._pipValueForCurrentQuantity)}`}),this._showRiskControls&&Number.isFinite(this._tradeValue)){const t="crypto"===this._type?this._tradeValue.toFixed(Object(P.n)(this._minTick)):Object(P.j)(this._tradeValue);h.push({title:this._showTotalInsteadOfTradeValue?G.total:G.tradeValue,value:`${this._currency} ${t}`})}this._showRiskControls&&o&&null!==n&&null!==u&&h.push({title:G.reward,value:this._riskFormatter.format(u)+"% ("+this._currency+" "+this._riskFormatter.format(n)+")"}),this._showRiskControls&&a&&null!==l&&null!==c&&h.push({title:G.risk,value:this._riskFormatter.format(c)+"% ("+this._currency+" "+this._riskFormatter.format(l)+")"}),this._infoTableData.setValue({rows:h})})).subscribe()];return this._hasMarginMeter&&e.push(Object(o.ensureNotNull)(this._marginAvailable$).subscribe((t=>this._updateAvailableMargin(t)))),e}title(){return G.title}infoTableData(){return this._infoTableData}hasMarginMeter(){return this._hasMarginMeter}availableMargin(){return this._availableMargin}usedMargin(){return this._usedMargin}pipValue(){throw new Error("not supported")}tradeValue(){throw new Error("not supported")}tpRiskInCurrency(){throw new Error("not supported")}tpRiskInPercent(){throw new Error("not supported")}slRiskInCurrency(){throw new Error("not supported")}slRiskInPercent(){throw new Error("not supported")}_updateAvailableMargin(t){this._availableMargin.setValue(t)}}var X=i("jofe"),Z=i("4qhP"),tt=i("txPx");const et=Object(tt.getLogger)("PromiseWithDefault");function it(t,e,i){return t.catch((t=>(et.logError(t),i&&i(),e)))}const st={symbol:window.t("Symbol"),ask:window.t("Ask"),bid:window.t("Bid"),orderType:window.t("Type"),side:window.t("Side"),quantity:window.t("Quantity"),price:window.t("Price"),stopPrice:window.t("Stop price"),limitPrice:window.t("Limit price"),currency:window.t("Currency"),stopLoss:window.t("Stop Loss"),takeProfit:window.t("Take Profit"),buy:window.t("Buy"),sell:window.t("Sell"),warning:window.t("Estimated money impact is for main order only.")};class rt{constructor(t,e,i,s,r,o,n,u){this.warnings=[],this.errors=[],this._infoTableQuotesData=new S.a({rows:[]},P.g),this._infoTableOrderData={rows:[]},this._infoTableCustomData=[],this.order=t,this.confirmId=e.confirmId,this.onCancelClick=s,this.onPlaceClick=r,this._quotes$=i,this._currency=u,this._formatter=o,this._quantityFormatter=n,this._infoTableCustomData=e.sections,this._fillQuotesInfo(),this._fillOrderInfo(),(t.takeProfit||t.stopLoss)&&this.warnings.push(st.warning),e.warnings&&this.warnings.push(...e.warnings),e.errors&&this.errors.push(...e.errors)}subscribe(){return this._quotes$.subscribe((t=>this._fillQuotesInfo(t)))}infoTableQuotesData(){return this._infoTableQuotesData}infoTableOrderData(){return this._infoTableOrderData}infoTableCustomData(){return this._infoTableCustomData}_fillQuotesInfo(t){const e=[{title:st.symbol,value:this.order.symbol},{title:st.ask,value:t?this._formatter.format(t.ask):""},{title:st.bid,value:t?this._formatter.format(t.bid):""}];this._infoTableQuotesData.setValue({rows:e})}_fillOrderInfo(){this._infoTableOrderData.rows.push({title:st.orderType,value:this.order.type?b.m[this.order.type]:""},{title:st.side,value:1===this.order.side?st.buy:st.sell,type:1===this.order.side?0:1},{title:st.quantity,value:this._quantityFormatter.format(this.order.qty)}),3!==this.order.type&&1!==this.order.type||this._infoTableOrderData.rows.push({title:st.price,value:this._formatter.format(3===this.order.type?this.order.stopPrice:this.order.limitPrice)}),4===this.order.type&&this._infoTableOrderData.rows.push({title:st.stopPrice,value:this._formatter.format(this.order.stopPrice)},{title:st.limitPrice,value:this._formatter.format(this.order.limitPrice)}),this.order.stopLoss&&this._infoTableOrderData.rows.push({title:st.stopLoss,value:String(this.order.stopLoss)}),this.order.takeProfit&&this._infoTableOrderData.rows.push({title:st.takeProfit,value:String(this.order.takeProfit)}),this._currency.length>0&&this._infoTableOrderData.rows.push({title:st.currency,value:this._currency})}}const ot=Object(tt.getLogger)("Trading.OrderViewModel");class nt{constructor(t,e,i,s,r,n,u,d,_,v,y=null,m,g,w,S){if(this.orderType=new a.a(null),this.orderInfoModel=null,this.orderPreviewModel=null,this.customFieldModels=new a.a([]),this.onDoneButtonClicked=Object(X.createDeferredPromise)(),this.status=new a.a(b.h.Active),this.rewardRisk=new a.a(""),this.disabled=new a.a(!1),this.loading=new a.a(!1),this.needSignIn=!1,this.noBroker=!1,this.symbolHasLotSize=!1,this.showRiskControls=!0,this.id=Object(p.randomHashN)(6),this.existingOrder=!1,this._prevOrderType=new a.a(null),this._onModeChanged=new f.a,this._onInputStateChanged=new f.a,this._onCloseButtonClicked=new f.a,this._onBackButtonClicked=new f.a,this._subscriptions=[],this._stopLossPips=new h.BehaviorSubject(25),this._stopLossAvailable=new h.BehaviorSubject(!1),this._orderWidgetStat=null,this._existingPlacedOrder=null,this._marginAvailable$=null,this._baseCurrencyCryptoBalance$=null,this._quoteCurrencyCryptoBalance$=null,this._orderPlacingStatus=new h.BehaviorSubject(b.i.Creating),this._destroyed=!1,this._setSolutionAccount=null,this.doneButtonClick=()=>{if(this.loading.value())return;this.loading.setValue(!0),this._initialInputState.quantity=this._currentInputState.quantity;const t=this.sideModel.numericQuotes.value(),e=(1===this.sideModel.side.value()?t.ask:t.bid)||0;let i={symbol:this.symbol,type:Object(o.ensureNotNull)(this.orderType.value()),side:this.sideModel.$value.getValue(),qty:0,seenPrice:e};if(i.qty=Object(o.ensureNotNull)(this.quantityModel.$value.getValue()),4===this.orderType.value()?(i.stopPrice=Object(o.ensureNotNull)(this.stopPriceModel.$value.getValue()),i.limitPrice=Object(o.ensureNotNull)(this.limitPriceModel.$value.getValue())):3===this.orderType.value()?i.stopPrice=Object(o.ensureNotNull)(this.stopPriceModel.$value.getValue()):1===this.orderType.value()&&(i.limitPrice=Object(o.ensureNotNull)(this.limitPriceModel.$value.getValue())),this.durationModel){const t=this.durationModel.getValue();null!==t&&(i.duration=t)}if(this.stopLossModel&&(delete i.stopLoss,delete i.trailingStopPips,this.stopLossModel.bracketType.value()===b.a.StopLoss&&(i.stopLoss=this.stopLossModel.enabled.value()?Object(o.ensureNotNull)(this.stopLossModel.$value.getValue()&&this.stopLossModel.price.value.value()):void 0,i.trailingStopPips=void 0),this.stopLossModel.bracketType.value()===b.a.TrailingStop&&(i.trailingStopPips=this.stopLossModel.enabled.value()?Object(o.ensureNotNull)(this.stopLossModel.$value.getValue()):void 0,i.stopLoss=void 0!==i.trailingStopPips?void 0:i.stopLoss)),this.takeProfitModel&&(i.takeProfit=this.takeProfitModel.enabled.value()?Object(o.ensureNotNull)(this.takeProfitModel.$value.getValue()&&this.takeProfitModel.price.value.value()):void 0),Array.isArray(this.customFieldModels.value())&&(i.customFields=this._getCustomFields()),(this.existingOrder?this.supportModifyOrderPreview:this.supportPlaceOrderPreview)&&this._settings.value().showOrderPreview){if(null===this.orderPreviewModel){const t=this.supportModifyOrderPreview&&null!==this._existingPlacedOrder?Object.assign(Object.assign({},i),{id:this._existingPlacedOrder.id}):i;return void this._adapter.previewOrder(t).then((e=>{this.orderPreviewModel=new rt(t,e,this._quotes$,this._back,this.doneButtonClick,this.formatter,this.quantityModel.formatter,Object(o.ensureDefined)(this.currency)),this._subscriptions.push(this.orderPreviewModel.subscribe()),this.loading.setValue(!1),this.status.setValue(b.h.Preview)})).catch((t=>{this.loading.setValue(!1),this._showErrorNotification(Object(l.t)("Order preview"),"object"==typeof t?t.message:t)}))}i=this.orderPreviewModel.order}this._doneHandler(i,null!==this.orderPreviewModel?this.orderPreviewModel.confirmId:void 0).then((t=>{this.loading.setValue(!1),null!==this.orderPreviewModel&&this._suggestedQty.setValue(this.symbol,this.orderPreviewModel.order.qty),t&&(this.onDoneButtonClicked.resolve(!0),this.mode.value()===b.g.Popup?this.headerModel.close():this._backToDefaultOrderPanel(),this.existingOrder||this._orderPlacingStatus.next(b.i.Placed)),t||null===this.orderPreviewModel||this._back(),this.orderPreviewModel=null}))},this.activateOrderPanel=()=>{this.status.setValue(this.existingOrder?b.h.Editing:b.h.Active),this.orderType.unsubscribe(this.activateOrderPanel),this.sideModel&&this.sideModel.onControlFocused.unsubscribe(this,this.activateOrderPanel),this.limitPriceModel&&this.limitPriceModel.onControlFocused.unsubscribe(this,this.activateOrderPanel),this.stopPriceModel&&this.stopPriceModel.onControlFocused.unsubscribe(this,this.activateOrderPanel),this.quantityModel&&this.quantityModel.onControlFocused.unsubscribe(this,this.activateOrderPanel),this.takeProfitModel&&this.takeProfitModel.onControlFocused.unsubscribe(this,this.activateOrderPanel),this.stopLossModel&&this.stopLossModel.onControlFocused.unsubscribe(this,this.activateOrderPanel),this.durationModel&&this.durationModel.onControlFocused.unsubscribe(this,this.activateOrderPanel),Array.isArray(this.customFieldModels.value())&&this.customFieldModels.value().length>0&&this.customFieldModels.value().forEach((t=>{t.onControlFocused.unsubscribe(this,this.activateOrderPanel)})),this._orderPlacingStatus.next(b.i.Creating)},this._noQuotesCallback=()=>{this._trackEvent("Order Ticket","No Quotes")},this._updateMode=()=>{this.mode.value()===b.g.Popup&&this.status.value()!==b.h.Preview&&this.activateOrderPanel(),this.toggleCancelButton()},this._syncOrderPricesAndFocuses=()=>{1===this.orderType.value()&&4===this._prevOrderType.value()&&(this.limitPriceModel.forceAbsolutePriceUpdate(this.stopPriceModel.price.value()),this.limitPriceModel.forceRelativePriceUpdate()),1===this.orderType.value()&&3===this._prevOrderType.value()&&(this.limitPriceModel.forceAbsolutePriceUpdate(this.stopPriceModel.price.value()),this.limitPriceModel.focusedControl.setValue(this.stopPriceModel.focusedControl.value()),this.limitPriceModel.forceRelativePriceUpdate()),3===this.orderType.value()&&1===this._prevOrderType.value()&&(this.stopPriceModel.forceAbsolutePriceUpdate(this.limitPriceModel.price.value()),this.stopPriceModel.focusedControl.setValue(this.limitPriceModel.focusedControl.value()),this.stopPriceModel.forceRelativePriceUpdate()),4===this.orderType.value()&&(1===this._prevOrderType.value()&&(this.stopPriceModel.forceAbsolutePriceUpdate(this.limitPriceModel.price.value()),this.stopPriceModel.forceRelativePriceUpdate()),3===this._prevOrderType.value()&&this.limitPriceModel.forceAbsolutePriceUpdate(this.stopPriceModel.price.value()),this._syncStopLimitPrices(),this.limitPriceModel.forceStopLimitRelativePriceUpdate()),this._prevOrderType.setValue(this.orderType.value())},this._syncStopLimitPrices=()=>{4===this.orderType.value()&&this.limitPriceModel.syncWithPrice(this.stopPriceModel.price.value())},this._back=()=>{this.orderPreviewModel=null,this.onDoneButtonClicked.resolve(!1),this._onBackButtonClicked.fire()},this._toggleTradingWidget=d,this._onNeedSelectBroker=_,this._showErrorNotification=m,this._trackEvent=v,this._orderWidgetStat=y,this._suggestedQty=g,this.mode=s,this._settings=r,function(t){return t.hasOwnProperty("id")}(e)&&(this.existingOrder=!0,this._existingPlacedOrder=e),this.status=new a.a(this.existingOrder?b.h.Editing:b.h.Active),this.symbol=e.symbol,this._orderStatusSubscription=Object(P.t)(this.status),this._loadingSubscription=Object(P.t)(this.loading),this._status=this._orderStatusSubscription.subject,this._loading=this._loadingSubscription.subject,this._panelCanBeShown=u,null===t)return void(this.onReady=Promise.resolve());if(this._adapter=t,!n.tradable)return void(this.onReady=this._prepareTradableSolution(n));this._handler=i,this._orderTemplate=Object.assign({},e),this.existingOrder=e.hasOwnProperty("id"),this.status.setValue(this.existingOrder?b.h.Editing:b.h.Active);const O=Boolean(e.takeProfit||e.stopLoss),k=t.metainfo().configFlags;this.supportEditAmount=k.supportEditAmount,this.showQuantityInsteadOfAmount=k.showQuantityInsteadOfAmount,this.supportMarketOrders=k.supportMarketOrders,this.supportLimitOrders=k.supportLimitOrders,this.supportStopOrders=k.supportStopOrders,this.supportStopLimitOrders=k.supportStopLimitOrders,this.supportBrackets=k.supportOrderBrackets&&!(e.hasOwnProperty("parentId")&&e.parentId)&&(!this.existingOrder||this.existingOrder&&(O||k.supportAddBracketsToExistingOrder)),this.supportTrailingStop=this.supportBrackets&&k.supportTrailingStop,this.supportModifyTrailingStop=this.supportBrackets&&k.supportModifyTrailingStop,this.supportMarketBrackets=k.supportMarketBrackets,this.supportModifyDuration=k.supportModifyDuration,this.supportPlaceOrderPreview=k.supportPlaceOrderPreview,this.supportModifyOrderPreview=k.supportModifyOrderPreview,this.supportCryptoExchangeOrderTicket=k.supportCryptoExchangeOrderTicket,this.durationForMarketOrders=k.durationForMarketOrders,this.supportBalances=k.supportBalances,this.supportCryptoBrackets=k.supportCryptoBrackets,this.supportStopOrdersInBothDirections=k.supportStopOrdersInBothDirections,this.orderType.setValue(e.hasOwnProperty("type")&&e.type||this.supportMarketOrders&&2||this.supportLimitOrders&&1||this.supportStopOrders&&3||this.supportStopLimitOrders&&4||null),this._prevOrderType.setValue(this.orderType.value()),this._orderTypeSubscription=Object(P.t)(this.orderType),this._orderType=this._orderTypeSubscription.subject,this._suggestedQty=g,this._suggestedQty.changed.subscribe(this,this._suggestedQtyChangedHandler),this.onReady=Promise.all([t.symbolInfo(e.symbol),t.getOrderDialogOptions(e.symbol),it(t.accountMetainfo(),{id:t.currentAccount(),name:t.metainfo().title}),it(t.quotesSnapshot(e.symbol),{},this._noQuotesCallback),it(t.formatter(e.symbol,!1),new I.PriceFormatter),it(t.spreadFormatter(e.symbol),new I.PriceFormatter),it(g.value(e.symbol),1e3)]).then((([i,s,r,o,u,a,l])=>{this._symbolInfo=i,this._destroyed||(this.displaySymbolName=i.brokerSymbol||"brokerSymbol"in e&&e.brokerSymbol||this.symbol,this.currency=Object(Z.e)(i,r),this.formatter=u,this.symbolHasLotSize=i.hasOwnProperty("lotSize"),this._initialInputState=this._getInitialInputState(t,e,l,w),this._currentInputState=Object.assign({},this._initialInputState),this.customFieldModels.setValue(Object(P.h)(this.existingOrder,this.status,s,Object.assign(this._currentInputState.customFields||{},e.customFields))),this._currentInputState.quantity=this._orderTemplate.qty||l,this._quotes$=c.Observable.fromEventPattern((i=>t.subscribeRealtime(e.symbol,i)),(i=>t.unsubscribeRealtime(e.symbol,i)),((t,e)=>Object(P.a)(e,i.minTick))).publishReplay(1).refCount(),this._equity$=c.Observable.fromEventPattern((e=>t.subscribeEquity(e)),(e=>t.unsubscribeEquity(e)),((t,e)=>e)).startWith(NaN).publishReplay(1).refCount(),this._marginAvailable$=k.supportMargin?c.Observable.fromEventPattern((e=>t.subscribeMarginAvailable(e)),(e=>t.unsubscribeMarginAvailable(e)),((t,e)=>e)).publish():null,this._baseCurrencyCryptoBalance$=k.supportBalances?c.Observable.fromEventPattern((e=>t.subscribeCryptoBalance(i.baseCurrency||"",e)),(e=>t.unsubscribeCryptoBalance(i.baseCurrency||"",e)),((t,e)=>e)).startWith({symbol:i.baseCurrency||"",total:0,available:0}).publish():null,this._quoteCurrencyCryptoBalance$=k.supportBalances?c.Observable.fromEventPattern((e=>t.subscribeCryptoBalance(i.quoteCurrency||"",e)),(e=>t.unsubscribeCryptoBalance(i.quoteCurrency||"",e)),((t,e)=>e)).startWith({symbol:i.quoteCurrency||"",total:0,available:0}).publish():null,this._pipValues$=c.Observable.fromEventPattern((i=>t.subscribePipValue(e.symbol,i)),(i=>t.unsubscribePipValue(e.symbol,i)),((t,e)=>e)).startWith({buyPipValue:i.pipValue,sellPipValue:i.pipValue}).publish(),this.showRiskControls=0!==i.pipValue,0===this._orderTemplate.limitPrice&&!1===this.existingOrder&&(this._orderTemplate.limitPrice=1===this._orderTemplate.side?Object(P.l)(o):Object(P.m)(o)),0===this._orderTemplate.stopPrice&&!1===this.existingOrder&&(this._orderTemplate.stopPrice=1===this._orderTemplate.side?Object(P.m)(o):Object(P.l)(o)),this._createModels(e,i,a,n.tradable,S,s),this._subscribe(),this._onInputStateChanged.fire(this._getCurrentInputState()))})).catch((t=>{throw ot.logError("Failed to create order model: "+t),t}))}destroy(){this._destroyed=!0,this._subscriptions.forEach((t=>t&&t.unsubscribe())),this._orderStatusSubscription.unsubscribe(),this._loadingSubscription.unsubscribe(),this._orderTypeSubscription&&this._orderTypeSubscription.unsubscribe(),this._suggestedQty&&this._suggestedQty.changed.unsubscribe(this,this._suggestedQtyChangedHandler),this.headerModel&&(this.headerModel.unsubscribe(),this.headerModel.pinButtonClicked().unsubscribe(this,this._toggleMode),this.headerModel.cancelButtonClicked().unsubscribe(this,this._cancel),this.headerModel.closeButtonClicked().unsubscribe(this,this._closeWidget),this.headerModel.backButtonClicked().unsubscribe(this,this._back)),this.sideModel&&(this.sideModel.unsubscribe(),this.sideModel.onControlFocused.unsubscribe(this,this.activateOrderPanel)),this.limitPriceModel&&(this.limitPriceModel.unsubscribe(),this.limitPriceModel.onControlFocused.unsubscribe(this,this.activateOrderPanel)),this.stopPriceModel&&(this.stopPriceModel.price.unsubscribe(this._syncStopLimitPrices),this.stopPriceModel.unsubscribe(),this.stopPriceModel.onControlFocused.unsubscribe(this,this.activateOrderPanel)),this.quantityModel&&(this.quantityModel.unsubscribe(),this.quantityModel.onControlFocused.unsubscribe(this,this.activateOrderPanel)),this.takeProfitModel&&(this.takeProfitModel.unsubscribe(),this.takeProfitModel.onControlFocused.unsubscribe(this,this.activateOrderPanel)),this.stopLossModel&&(this.stopLossModel.unsubscribe(),this.stopLossModel.onControlFocused.unsubscribe(this,this.activateOrderPanel)),this.durationModel&&(this.durationModel.unsubscribe(),this.durationModel.onControlFocused.unsubscribe(this,this.activateOrderPanel)),Array.isArray(this.customFieldModels.value())&&this.customFieldModels.value().length>0&&this.customFieldModels.value().forEach((t=>{t.onControlFocused.unsubscribe(this,this.activateOrderPanel),t.subscription&&t.subscription.unsubscribe()})),this.buttonModel&&this.buttonModel.unsubscribe(),this._customFieldsSubscription&&this._customFieldsSubscription.unsubscribe(),this._adapter&&this._adapter.orderUpdate.unsubscribe(this,this._orderUpdate),this.orderType.unsubscribe(this._syncOrderPricesAndFocuses),this.orderType.unsubscribe(this.activateOrderPanel),this.mode.unsubscribe(this._updateMode)}onModeChanged(){return this._onModeChanged}onInputStateChanged(){return this._onInputStateChanged}onCloseButtonClicked(){return this._onCloseButtonClicked}onBackButtonClicked(){return this._onBackButtonClicked}side(){var t;return null===(t=this.sideModel)||void 0===t?void 0:t.side.value()}setSolutionAccount(){null!==this._setSolutionAccount&&this._setSolutionAccount()}selectBroker(){this._toggleTradingWidget().then((()=>this._onNeedSelectBroker.fire()))}orderWidgetStat(){return this._orderWidgetStat}resetOrderPanel(){this._cancel()}deactivateOrderPanel(){this.status.value()!==b.h.Wait&&(this.status.setValue(b.h.Wait),this.orderType.subscribe(this.activateOrderPanel),this.sideModel&&this.sideModel.onControlFocused.subscribe(this,this.activateOrderPanel),this.limitPriceModel&&this.limitPriceModel.onControlFocused.subscribe(this,this.activateOrderPanel),this.stopPriceModel&&this.stopPriceModel.onControlFocused.subscribe(this,this.activateOrderPanel),this.quantityModel&&this.quantityModel.onControlFocused.subscribe(this,this.activateOrderPanel),this.takeProfitModel&&(this.takeProfitModel.enabled.setValue(!1),this.takeProfitModel.onControlFocused.subscribe(this,this.activateOrderPanel)),this.stopLossModel&&(this.stopLossModel.enabled.setValue(!1),this.stopLossModel.onControlFocused.subscribe(this,this.activateOrderPanel)),this.durationModel&&this.durationModel.onControlFocused.subscribe(this,this.activateOrderPanel),Array.isArray(this.customFieldModels.value())&&this.customFieldModels.value().length>0&&this.customFieldModels.value().forEach((t=>{t.onControlFocused.subscribe(this,this.activateOrderPanel)})),this._setDisabledIfNeeded(this._status.getValue(),this._loading.getValue(),null,this.sideModel?this.sideModel.$value.getValue():null,this.limitPriceModel?this.limitPriceModel.$value.getValue():null,this.stopPriceModel?this.stopPriceModel.$value.getValue():null,this.quantityModel?this.quantityModel.$value.getValue():null,this.takeProfitModel?this.takeProfitModel.$value.getValue():null,this.stopLossModel?this.stopLossModel.$value.getValue():null))}toggleCancelButton(){this.mode.value()===b.g.Panel&&this.status.value()===b.h.Active?this.headerModel.showCancelButton():this.headerModel.hideCancelButton()}_createSimpleDialog(t){this.orderType.setValue(null),this.status.setValue(b.h.Wait),this.headerModel=new m(this.symbol,t?t.metainfo().title:"",this.mode,this.status,1,!1,!1,this._quotes$,this._panelCanBeShown),this.headerModel.closeButtonClicked().subscribe(this,this._closeWidget)}_createModels(t,e,i,s,r,n){this.sideModel=new g(this._quotes$,this.formatter,i,this._orderTemplate.side||1,this.status,this.supportCryptoExchangeOrderTicket&&"crypto"===e.type&&e.baseCurrency||null),this._pipValue$=c.Observable.combineLatest(this._pipValues$,this.sideModel.$value,((t,e)=>1===e?t.buyPipValue:t.sellPipValue));const{orderRules:u,title:a}=this._adapter.metainfo();this.limitPriceModel=new j(this._quotes$,this.sideModel.$value,e,this.status,this._orderTemplate.limitPrice,this.formatter,this.orderType,!0,this._settings,a,this._orderWidgetStat,u,r),this.stopPriceModel=new j(this._quotes$,this.sideModel.$value,e,this.status,this._orderTemplate.stopPrice,this.formatter,this.orderType,!1,this._settings,a,this._orderWidgetStat,u,r,this.supportStopOrdersInBothDirections),this._syncStopLimitPrices(),this._price$=c.Observable.combineLatest(this._orderType,this.sideModel.$value,this._quotes$,this.stopPriceModel.$value,this.limitPriceModel.$value,((t,e,i,s,r)=>{const o=1===e?Object(P.l)(i):Object(P.m)(i),n=(i.trade?i.trade:o)||0;switch(this._initialInputState.limitPrice=o,this._initialInputState.stopPrice=o,t){case 1:case 4:return(null===r?this.limitPriceModel.price.value():r)||n;case 3:return(null===s?this.stopPriceModel.price.value():s)||n;default:return o}})),this.supportCryptoExchangeOrderTicket?this.quantityModel=new R(e,this._price$,this._baseCurrencyCryptoBalance$,this._quoteCurrencyCryptoBalance$,this._currentInputState.quantity,this.status,this.sideModel.side,this._orderWidgetStat):this.quantityModel=new x(this._stopLossAvailable,this._stopLossPips,this._equity$,this._pipValue$,e,Object(o.ensureDefined)(this.currency),this._currentInputState.quantity,this.status,this._settings,this._orderWidgetStat,this.showRiskControls),(this.supportBrackets||this.supportCryptoBrackets)&&this._createBracketsModels(t,e,Object(o.ensureDefined)(this.currency)),this.headerModel=new m(this.displaySymbolName,this._adapter.metainfo().title,this.mode,this.status,1,this.existingOrder,s,this._quotes$,this._panelCanBeShown,t,this.formatter);const l=Object(P.w)(n);this.supportCryptoExchangeOrderTicket||(this.orderInfoModel=new J(this._marginAvailable$,this.quantityModel.$value,Object(o.ensureDefined)(this.currency),this._pipValue$,this._price$,this.sideModel.$value,l,this.showRiskControls,e,this.supportBrackets&&this.takeProfitModel?{enabled:this.takeProfitModel.enabled,riskInCurrency:this.takeProfitModel.riskInCurrency.value,riskInPercent:this.takeProfitModel.riskInPercent.value}:null,this.supportBrackets&&this.stopLossModel?{enabled:this.stopLossModel.enabled,riskInCurrency:this.stopLossModel.riskInCurrency.value,riskInPercent:this.stopLossModel.riskInPercent.value}:null,this._adapter.metainfo().configFlags.supportMargin||!1));const h=e.allowedDurations;let d=this._adapter.metainfo().durations;if(void 0!==d&&d.length>0){let t,e=Object(z.e)(d[0]),i=!0;if(void 0!==h&&(d=d.filter((t=>h.includes(t.value)))),void 0!==this._orderTemplate.duration)i=function(t,e){return-1!==e.findIndex((e=>t===e.value))}(this._orderTemplate.duration.type,d),e=Object.assign({},this._orderTemplate.duration);else if(t=d.find((t=>this._currentInputState.duration&&t.value===this._currentInputState.duration.type)),void 0===t){const i=Object(z.a)(this.orderType.value(),d);i.length>0&&(t=i.find((t=>Boolean(t.default)))||i[0],e=Object(z.e)(t))}else e=Object(z.e)(t);i&&(this.durationModel=new U(e,d,this.orderType,this._orderWidgetStat,this.durationForMarketOrders))}}_createBracketsModels(t,e,i){this.takeProfitModel=new Q(t.takeProfit||null,Boolean(t.takeProfit),b.a.TakeProfit,this.formatter,this._equity$,this._quotes$,e,this._pipValue$,this.sideModel.$value,this.quantityModel.$value,this._price$,this._orderType,i,1,this._currentInputState.takeProfitPips,this._settings,this._orderWidgetStat,this.showRiskControls,this.status.value(),this.supportModifyTrailingStop,this.supportCryptoBrackets);const s=Boolean(t.trailingStopPips);this.stopLossModel=new Q(s?null:t.stopLoss||null,Boolean(s?t.trailingStopPips:t.stopLoss),s?b.a.TrailingStop:b.a.StopLoss,this.formatter,this._equity$,this._quotes$,e,this._pipValue$,this.sideModel.$value,this.quantityModel.$value,this._price$,this._orderType,i,1,(s?t.trailingStopPips:this._currentInputState.stopLossPips)||null,this._settings,this._orderWidgetStat,this.showRiskControls,this.status.value(),this.supportModifyTrailingStop,this.supportCryptoBrackets),this.supportCryptoExchangeOrderTicket||(this.stopLossModel.focusedControl.subscribe((t=>{2!==t&&3!==t||this.quantityModel.focusedControl.setValue(0)})),this.quantityModel.focusedControl.subscribe((t=>{!this.stopLossModel||1===this.stopLossModel.focusedControl.value()||1!==t&&2!==t||this.stopLossModel.focusedControl.setValue(0)}))),this._rewardRiskSubscription=c.Observable.combineLatest(this.takeProfitModel.$value,this.stopLossModel.$value).subscribe((([t,e])=>{this.rewardRisk.setValue(Object(P.k)(t,e))})),this.stopLossModel.$value.subscribe((t=>{this.stopLossModel&&(this._stopLossAvailable.next(this.stopLossModel.enabled.value()),null!==t&&this._stopLossPips.next(t))}))}_subscribe(){this.mode.subscribe(this._updateMode),this.headerModel.pinButtonClicked().subscribe(this,this._toggleMode),this.headerModel.cancelButtonClicked().subscribe(this,this._cancel),this.headerModel.closeButtonClicked().subscribe(this,this._closeWidget),this.headerModel.backButtonClicked().subscribe(this,this._back),this.buttonModel=new K(1,this.status,this.existingOrder,{orderType:this.orderType,side:this.sideModel.$value,quantity:this.quantityModel.$value,symbol:this.displaySymbolName,stopPrice:this.stopPriceModel.$value,limitPrice:this.limitPriceModel.$value,formatter:this.formatter,quantityFormatter:this.quantityModel.formatter,orderPlacingStatus:this._orderPlacingStatus});const t=[this._status,this.sideModel.$value,this._loading,this._quotes$,this.limitPriceModel.$value,this.stopPriceModel.$value,this.quantityModel.$value];if(this.takeProfitModel&&t.push(this.takeProfitModel.$value),this.stopLossModel&&t.push(this.stopLossModel.$value),this._buttonDataSubscription=c.Observable.combineLatest(t,((t,e,i,s,...r)=>{const[o,n,u,a,l]=r;this._setDisabledIfNeeded(t,i,s,e,o,n,u,a,l),this._compareInputStates(e,o,n,u,a,l)})).subscribe(),this.customFieldModels){const t=[];this._getSavableCustomFieldModels().forEach((e=>{const i=Object(P.t)(e.selectedItem);t.push(i.subject),e.subscription=i})),t.length&&(this._customFieldsSubscription=c.Observable.combineLatest(t,((...t)=>{Object(d.deepEquals)(this._getCustomFields(this._getSavableCustomFieldModels()),this._currentInputState.customFields)[0]||this._onInputStateChanged.fire(this._getCurrentInputState())})).subscribe())}this._subscriptions=[this.sideModel.subscribe(),this.limitPriceModel.subscribe(),this.stopPriceModel.subscribe(),this._price$.subscribe()],null!==this.orderInfoModel&&this._subscriptions.push(...this.orderInfoModel.subscribe()),this._subscriptions.push(this._buttonDataSubscription,this._pipValues$.connect()),null!==this._marginAvailable$&&this._subscriptions.push(this._marginAvailable$.connect()),this.supportBrackets&&this._subscriptions.push(this._rewardRiskSubscription),null!==this._baseCurrencyCryptoBalance$&&this._subscriptions.push(this._baseCurrencyCryptoBalance$.connect()),null!==this._quoteCurrencyCryptoBalance$&&this._subscriptions.push(this._quoteCurrencyCryptoBalance$.connect()),this.orderType.subscribe(this._syncOrderPricesAndFocuses),this._adapter.orderUpdate.subscribe(this,this._orderUpdate),this.stopPriceModel.price.subscribe(this._syncStopLimitPrices)}_backToDefaultOrderPanel(){this.mode.value()===b.g.Panel&&!0===this.existingOrder?this._back():this.mode.value()===b.g.Panel&&!1===this.existingOrder&&this._cancel()}_orderUpdate(t){this.existingOrder&&t.id===this._orderTemplate.id&&6!==t.status&&this._back()}async _doneHandler(t,e){this._suggestedQty.setValue(t.symbol,t.qty),await this._getAndSendStatistics(t),null!==this._orderWidgetStat&&this._orderWidgetStat.clear();const i=this._handler;return this._isHandlerPlacedOrder(i)?i(Object.assign({},this._existingPlacedOrder,t),e):i(t,e)}_isHandlerPlacedOrder(t){return this.existingOrder}async _getAndSendStatistics(t){var e;const i=this.stopLossModel&&this.stopLossModel.enabled.value(),s=this.takeProfitModel&&this.takeProfitModel.enabled.value(),r=i&&this.supportTrailingStop,o=1===t.side?"Buy":"Sell",n=["Price","Pips"],u=this.quantityModel.focusedControl.value(),a=["Pips","Price","RiskInCurrency","RiskInPercent"],l=["Limit","Market","Stop","StopLimit"][t.type-1],c=this.durationModel?this.durationModel.getValue():null,h=4===t.type,d=3===t.type||h,p=1===t.type||h,b=Object.assign({},this._settings.value()),_=this.limitPriceModel&&!this.limitPriceModel.isRelativePriceControlHidden||this.stopPriceModel&&!this.stopPriceModel.isRelativePriceControlHidden,f=Boolean(this.supportBrackets);function v(t,e){return e[null!==t?t:0]}b.showRelativePriceControl=b.showRelativePriceControl&&_,b.showCurrencyRiskInQty=b.showCurrencyRiskInQty&&f,b.showPercentRiskInQty=b.showPercentRiskInQty&&f,b.showBracketsInCurrency=b.showBracketsInCurrency&&f,b.showBracketsInPercent=b.showBracketsInPercent&&f,b.showOrderPreview=b.showOrderPreview&&Boolean(this.supportPlaceOrderPreview||this.supportModifyOrderPreview),null!==this._orderWidgetStat&&(this._orderWidgetStat.setStaticSnowplowEventDataProperty({accountType:this._adapter.currentAccountType(),brokerId:this._adapter.metainfo().id,orderTicketMode:this.mode.value(),side:o,orderType:l,symbolType:void 0!==this._symbolInfo.type?this._symbolInfo.type:null,operation:this.existingOrder?"Modify":"Place",stopLoss:i?this._currentInputState.stopLossPips:null,takeProfit:s?this._currentInputState.takeProfitPips:null,trailingStop:r?this._currentInputState.stopLossPips:null,guaranteedStop:null,focusedTPField:s&&this.takeProfitModel?v(this.takeProfitModel.focusedControl.value(),a):null,focusedSLField:i&&void 0!==this.stopLossModel?v(this.stopLossModel.focusedControl.value(),a):null,focusedQtyField:null!==(e=["Units","RiskInCurrency","RiskInPercent","BaseCurrencyQuantity","QuoteCurrencyQuantity"][null!==u?u:0])&&void 0!==e?e:null,focusedLimitPriceField:p||h&&this.limitPriceModel?v(this.limitPriceModel.focusedControl.value(),n):null,focusedStopPriceField:d&&this.stopPriceModel?n[this.stopPriceModel.focusedControl.value()]:null,duration:null!==c?c.type:null,isDefaultDuration:null!==c?c.type===this._getDefaultDuration().value:null,showBracketsInCurrency:b.showBracketsInCurrency,showBracketsInPercent:b.showBracketsInPercent,showCurrencyRiskInQty:b.showCurrencyRiskInQty,showOrderPreview:b.showOrderPreview,showPercentRiskInQty:b.showPercentRiskInQty,showRelativePriceControl:b.showRelativePriceControl}),await this._orderWidgetStat.trackStat())}_getInitialInputState(t,e,i,s){var r,o;const n=t.metainfo().durations,u=null!==(r=null==s?void 0:s.customFields)&&void 0!==r?r:{};let a;return Array.isArray(n)&&0!==n.length&&(a=void 0!==e.duration?Object.assign({},e.duration):void 0!==s&&null!==s.duration?Object.assign({},s.duration):{type:n[0].value}),void 0!==a&&void 0===a.datetime&&["GTD","GTT","GDP","DTT","GoodTillDate"].includes(a.type)&&(a.datetime=Date.now()+864e5),{symbol:this.symbol,side:e.side||1,limitPrice:e.limitPrice||e.price||e.stopPrice||0,stopPrice:e.stopPrice||e.price||e.limitPrice||0,quantity:e.qty||i,takeProfitPips:void 0!==s?s.takeProfitPips:b.b.TakeProfit,stopLossPips:void 0!==s?s.stopLossPips:b.b.StopLoss,customFields:null!==(o=e.customFields)&&void 0!==o?o:u,duration:a||null}}_compareInputStates(t,e,i,s,r,o){0===this._initialInputState.limitPrice&&null!==e&&(this._initialInputState.limitPrice=e),0===this._initialInputState.stopPrice&&null!==i&&(this._initialInputState.stopPrice=i);const n=this.orderType.value();let u=null===e;if(null!==e){const t=this.formatter.format(e),i=null!==this._currentInputState.limitPrice?this.formatter.format(this._currentInputState.limitPrice):null;u=3!==n&&t!==i}let a=null!==i;if(null!==i){const t=this.formatter.format(i),e=null!==this._currentInputState.stopPrice?this.formatter.format(this._currentInputState.stopPrice):null;a=(3===n||4===n)&&t!==e}const l=null!==s&&this._currentInputState.quantity!==s,c=null!==r&&this._currentInputState.takeProfitPips!==r,h=null!==o&&this._currentInputState.stopLossPips!==o,d=u||a||l||c||h;(this._currentInputState.symbol!==this.symbol||null!==t&&this._currentInputState.side!==t||d)&&this._onInputStateChanged.fire(this._getCurrentInputStateWithoutCustomFields())}_getSavableCustomFieldModels(){return this.customFieldModels.value().filter((t=>t.saveToSettings&&"ComboBox"===t.type)).map((t=>(t.selectedItem.value()===t.items[0].value&&t.selectedItem.setValue(""),t)))}_getCustomFields(t){t||(t=this.customFieldModels.value());const e={};return t.forEach((t=>{"TextWithCheckBox"===t.type?e[t.id]={text:t.text.value().replace(/&quote;/g,'"'),checked:t.checked.value()}:e[t.id]=t.selectedItem.value()||t.items[0].value})),e}_getCurrentInputState(){var t;return{symbol:this.symbol,side:this.sideModel.$value.getValue(),limitPrice:this.limitPriceModel.$value.getValue(),stopPrice:this.stopPriceModel.$value.getValue(),quantity:this.quantityModel.$value.getValue(),takeProfitPips:this.takeProfitModel?this.takeProfitModel.pips.value.value():null,stopLossPips:this.stopLossModel?this.stopLossModel.pips.value.value():null,duration:(null===(t=this.durationModel)||void 0===t?void 0:t.$value.getValue())||null,customFields:this._getCustomFields(this._getSavableCustomFieldModels())}}_getCurrentInputStateWithoutCustomFields(){return Object.assign(Object.assign({},this._getCurrentInputState()),{customFields:null})}_setDisabledIfNeeded(t,e,i,s,r,o,n,u,a){this.disabled.setValue(this.mode.value()===b.g.Panel&&t===b.h.Wait||e||Object(P.s)(i)||null===s||Object(P.f)(this.orderType.value(),r,o)||null===n||Boolean(this.takeProfitModel&&!this.takeProfitModel.readyToSubmit())||Boolean(this.stopLossModel&&!this.stopLossModel.readyToSubmit()))}_suggestedQtyChangedHandler(t){t===this.symbol&&this.quantityModel&&this._suggestedQty.value(t).then((t=>{this.quantityModel.quantity.value.value()!==t&&(this.quantityModel.focusedControl.setValue(this.supportCryptoExchangeOrderTicket?3:0),this._currentInputState.quantity=t,this.quantityModel.quantity.value.setValue(t))}))}_toggleMode(){this.mode.setValue(this.mode.value()===b.g.Panel?b.g.Popup:b.g.Panel),this._updateMode(),this._onModeChanged.fire(this.mode.value())}_closeWidget(){this.orderPreviewModel=null,this.onDoneButtonClicked.resolve(!1),this._onCloseButtonClicked.fire()}_cancel(){this.orderPreviewModel=null,this.onDoneButtonClicked.resolve(!1),this.deactivateOrderPanel(),this._currentInputState=Object.assign({},this._initialInputState),this.limitPriceModel&&this.limitPriceModel.forcePricesUpdate(this._initialInputState.limitPrice),this.stopPriceModel&&this.stopPriceModel.forcePricesUpdate(this._initialInputState.stopPrice),this.quantityModel&&this.quantityModel.quantity.value.setValue(this._initialInputState.quantity),this.takeProfitModel&&this.takeProfitModel.enabled.setValue(!1),this.stopLossModel&&this.stopLossModel.enabled.setValue(!1),this.durationModel&&this._initialInputState.duration&&this.durationModel.currentDuration.setValue(this._initialInputState.duration),this._orderPlacingStatus.next(b.i.Creating),this.existingOrder&&this._back()}_getDefaultDuration(){const t=Object(o.ensureDefined)(this._adapter.metainfo().durations);return t.find((t=>Boolean(t.default)))||t[0]}async _prepareTradableSolution(t){this.tradableSolution=await Object(P.v)(t,this._adapter),this._createSimpleDialog(this._adapter),this.notTradableText=t.reason}}const ut={title:window.t("Position Info"),pipValue:window.t("Pip Value"),tradeValue:window.t("Trade Value"),total:window.t("Total"),leverage:window.t("Leverage"),lotSize:window.t("Lot Size")};class at{constructor(t,e,i,s,r){this._infoTableData=new S.a({rows:[]},P.g),this._infoTableRows=[],this._riskFormatter=new I.PriceFormatter(100),this._currency=e,this._showTotalInsteadOfTradeValue=s,this._type=r.type,this._minTick=r.minTick,this._leverage=r.leverage,this._marginRate=r.marginRate,this._lotSize=r.lotSize,this._pipValue=Object(P.b)(t,r.pipValue,this._lotSize),this._tradeValue="crypto"===this._type?(null!==t?t:0)*i:Object(P.c)(t,i,r.pipValue,r.pipSize,this._lotSize);const o=Object(P.i)(this._leverage,this._marginRate);if(null!==o&&this._infoTableRows.push({title:ut.leverage,value:o}),"number"==typeof this._lotSize&&Number.isFinite(this._lotSize)&&this._infoTableRows.push({title:ut.lotSize,value:""+this._lotSize}),"crypto"!==this._type&&Number.isFinite(this._pipValue)&&this._infoTableRows.push({title:ut.pipValue,value:`${this._currency} ${Object(P.j)(this._pipValue)}`}),Number.isFinite(this._tradeValue)){const t="crypto"===this._type?this._tradeValue.toFixed(Object(P.n)(this._minTick)):Object(P.j)(this._tradeValue);this._infoTableRows.push({title:this._showTotalInsteadOfTradeValue?ut.total:ut.tradeValue,value:`${this._currency} ${t}`})}this._infoTableData.setValue({rows:this._infoTableRows})}title(){return ut.title}infoTableData(){return this._infoTableData}pipValue(){throw new Error("not supported")}tradeValue(){throw new Error("not supported")}tpRiskInCurrency(){throw new Error("not supported")}tpRiskInPercent(){throw new Error("not supported")}slRiskInCurrency(){throw new Error("not supported")}slRiskInPercent(){throw new Error("not supported")}}const lt={bracketsWarning:window.t("You already have at least one working order that can affect this position")};class ct{constructor(t,e,i,s,r,o,n,u,l){this.positionInfoModel=null,this.customFieldModels=new a.a([]),this.onDoneButtonClicked=Object(X.createDeferredPromise)(),this.rewardRisk=new a.a(""),this.disabled=new a.a(!1),this.loading=new a.a(!1),this.status=new a.a(b.h.Active),this.id=Object(p.randomHashN)(6),this.warning=new a.a(void 0),this.showRiskControls=!0,this._onModeChanged=new f.a,this._onBackButtonClicked=new f.a,this._onCloseButtonClicked=new f.a,this._loadingSubscription=Object(P.t)(this.loading),this._loading=this._loadingSubscription.subject,this.mode=r,this._position=e,this._settings=o,this._adapter=t,this.position=e,this.symbol=e.symbol,this.brackets=i,this._handler=s,this._panelCanBeShown=n;const h=this._adapter.metainfo().configFlags;this.supportTrailingStop=h.supportTrailingStop,this.supportModifyTrailingStop=h.supportModifyTrailingStop,this.supportPositions=h.supportPositions,this.supportTrades=h.supportTrades,this.supportOnlyPairPositionBrackets=h.supportOnlyPairPositionBrackets,this._adapter.orders().then((t=>{const i=t.filter((t=>2===t.parentType&&t.parentId===e.id)),s=i.length?i[0].customFields:void 0,r=this._adapter.getPositionDialogOptions();this.customFieldModels.setValue(Object(P.h)(Boolean(i.length),this.status,r,s)),this.supportOnlyPairPositionBrackets&&this._updateWarning()})),this._trackEvent=l,this.onReady=Promise.all([t.symbolInfo(e.symbol),t.getOrderDialogOptions(e.symbol),it(t.accountMetainfo(),{id:t.metainfo().id,name:t.metainfo().title}),it(t.formatter(e.symbol,!1),new I.PriceFormatter)]).then((([s,r,o,n])=>{this.showRiskControls=0!==s.pipValue,this.currency=Object(Z.e)(s,o),this.brokerSymbol=s.brokerSymbol||e.brokerSymbol||this.symbol,this._quotes$=c.Observable.fromEventPattern((t=>u.subscribeRealtime(e.symbol,t)),(t=>u.unsubscribeRealtime(e.symbol,t)),((t,e)=>e)).publish(),this._equity$=c.Observable.fromEventPattern((e=>t.subscribeEquity(e)),(e=>t.unsubscribeEquity(e)),((t,e)=>e)).publish(),this._pipValues$=c.Observable.fromEventPattern((i=>t.subscribePipValue(e.symbol,i)),(i=>t.unsubscribePipValue(e.symbol,i)),((t,e)=>e)).startWith({buyPipValue:s.pipValue,sellPipValue:s.pipValue}).publish(),this._pipValue$=this._pipValues$.map((t=>1===e.side?t.buyPipValue:t.sellPipValue)),this._createModels(i,s,o,this.mode,n,r),this._subscribe()}))}destroy(){this._subscriptions&&this._subscriptions.forEach((t=>t.unsubscribe())),this.headerModel&&(this.headerModel.unsubscribe(),this.headerModel.pinButtonClicked().unsubscribe(this,this._toggleMode),this.headerModel.backButtonClicked().unsubscribe(this,this._back),this.headerModel.closeButtonClicked().unsubscribe(this,this._closeWidget)),this.takeProfitModel&&this.takeProfitModel.unsubscribe(),this.stopLossModel&&this.stopLossModel.unsubscribe(),this.buttonModel&&this.buttonModel.unsubscribe(),this.supportPositions&&this._adapter.positionUpdate.unsubscribe(this,this._positionOrTradeUpdate),this.supportTrades&&this._adapter.tradeUpdate.unsubscribe(this,this._positionOrTradeUpdate),this.supportOnlyPairPositionBrackets&&(this._adapter.orderUpdate.unsubscribe(this,this._updateWarning),this._slEnabled&&this._slEnabled.destroy(),this._tpEnabled&&this._tpEnabled.destroy())}side(){return this._position.side}doneButtonClick(){this.loading.setValue(!0),this._doneHandler().then((t=>{t&&(this.onDoneButtonClicked.resolve(!0),this.mode.value()===b.g.Popup?this.headerModel.close():this._back(),this._trackEvent("Position Ticket","Modify Position",this.mode.value()===b.g.Panel?"Panel":"Popup")),this.loading.setValue(!1)}))}onModeChanged(){return this._onModeChanged}onBackButtonClicked(){return this._onBackButtonClicked}onCloseButtonClicked(){return this._onCloseButtonClicked}_createModels(t,e,i,s,r,o){const n=Object(Z.e)(e,i)||"$",u=new h.BehaviorSubject(this._position.side||-1);this.headerModel=new m(this.brokerSymbol," ",s,this.status,2,!0,!0,this._quotes$,this._panelCanBeShown,this._position,this._position.priceFormatter?this._position.priceFormatter:r),this.takeProfitModel=new Q(t.takeProfit||this._position.takeProfit||null,Boolean(t.takeProfit||this._position.takeProfit),b.a.TakeProfit,r,this._equity$,this._quotes$,e,this._pipValue$,u,new h.BehaviorSubject(this._position.qty),new h.BehaviorSubject(this._position.avgPrice),new h.BehaviorSubject(null),n,2,null,this._settings,null,this.showRiskControls,this.status.value(),this.supportModifyTrailingStop);const a=t.trailingStopPips||this._position.trailingStopPips,l=t.stopLoss||this._position.stopLoss,c=Boolean(a);this.stopLossModel=new Q(c?null:l||null,Boolean(c?a:l),c?b.a.TrailingStop:b.a.StopLoss,r,this._equity$,this._quotes$,e,this._pipValue$,u,new h.BehaviorSubject(this._position.qty),new h.BehaviorSubject(this._position.avgPrice),new h.BehaviorSubject(null),n,2,a||null,this._settings,null,this.showRiskControls,this.status.value(),this.supportModifyTrailingStop);const d=Object(P.w)(o);this.supportOnlyPairPositionBrackets||(this.positionInfoModel=new at(this._position.qty,Object(Z.e)(e,i),this._position.avgPrice,d,e)),this.buttonModel=new K(2,this.status,!0)}_updateWarning(){this._adapter.orders().then((t=>{const e=t.find((t=>t.symbol===this._position.symbol&&t.side!==this._position.side&&(6===t.status&&void 0===t.parentId||3===t.status)));this.warning.setValue(e?lt.bracketsWarning:void 0)}))}_subscribe(){this.headerModel.pinButtonClicked().subscribe(this,this._toggleMode),this.headerModel.backButtonClicked().subscribe(this,this._back),this.headerModel.closeButtonClicked().subscribe(this,this._closeWidget),this._buttonDataSubscription=c.Observable.combineLatest(this.takeProfitModel.$value,this.stopLossModel.$value,this._loading,this._quotes$).subscribe((([t,e,i,s])=>{this.disabled.setValue(i||Object(P.s)(s)||this.takeProfitModel.enabled.value()&&null===t||this.stopLossModel.enabled.value()&&null===e)})),this._rewardRiskSubscription=c.Observable.combineLatest(this.takeProfitModel.$value,this.stopLossModel.$value).subscribe((([t,e])=>{this.rewardRisk.setValue(Object(P.k)(t,e))})),this._subscriptions=[this._rewardRiskSubscription,this._buttonDataSubscription,this._equity$.connect(),this._quotes$.connect(),this._pipValues$.connect()],this.supportPositions&&this._adapter.positionUpdate.subscribe(this,this._positionOrTradeUpdate),this.supportTrades&&this._adapter.tradeUpdate.subscribe(this,this._positionOrTradeUpdate),this.supportOnlyPairPositionBrackets&&(this._adapter.orderUpdate.subscribe(this,this._updateWarning),this._slEnabled=this.stopLossModel.enabled.spawn(),this._slEnabled.subscribe((t=>{this.takeProfitModel.enabled.setValue(t)})),this._tpEnabled=this.takeProfitModel.enabled.spawn(),this._tpEnabled.subscribe((t=>{this.stopLossModel.enabled.setValue(t)})))}_doneHandler(){const t=null!==this.stopLossModel.$value.getValue()?this.stopLossModel.price.value.value():null,e=this.stopLossModel.$value.getValue(),i=null!==this.takeProfitModel.$value.getValue()?this.takeProfitModel.price.value.value():null,s={};if(null!==e&&null!==t&&(this.stopLossModel.bracketType.value()===b.a.StopLoss&&(s.stopLoss=t),this.stopLossModel.bracketType.value()===b.a.TrailingStop&&(s.trailingStopPips=e)),null!==i&&(s.takeProfit=i),Array.isArray(this.customFieldModels.value())){const t={};return this.customFieldModels.value().forEach((e=>{"TextWithCheckBox"===e.type?t[e.id]={text:e.text.value().replace(/&quote;/g,'"'),checked:e.checked.value()}:t[e.id]=e.selectedItem.value()})),this._getAndSendStatistics(),this._handler(this.position.id,s,t)}return this._getAndSendStatistics(),this._handler(this.position.id,s)}_getAndSendStatistics(){const t=this.stopLossModel.enabled.value(),e=this.stopLossModel.focusedControl.value(),i=this.takeProfitModel.enabled.value(),s=this.takeProfitModel.focusedControl.value(),r=this.stopLossModel&&this.stopLossModel.bracketType.value(),o=["Pips","Price","RiskInCurrency","RiskInPercent"],n=[" Disabled"," Active"],u={SL:{active:n[+t],mode:null!==e?o[e]:o[1]},TP:{active:n[+i],mode:null!==s?o[s]:o[1]}};this.supportTrailingStop&&(u.SLType={active:n[+t],mode:["StopLoss","TakeProfit","TrailingStop"][r]});const a=this._settings.value();Object.keys(a).filter((t=>["showBracketsInCurrency","showBracketsInPercent"].includes(t))).forEach((t=>{this._trackEvent("Order Ticket",t,a[t]?"on":"off")})),Object.keys(u).forEach((t=>{u[t].active&&this._trackEvent("Position Ticket",t,u[t].mode)}))}_positionOrTradeUpdate(t){t.id!==this.position.id||0!==t.qty&&this.position.side===t.side||this._back()}_toggleMode(){this.mode.setValue(this.mode.value()===b.g.Panel?b.g.Popup:b.g.Panel),this._onModeChanged.fire(this.mode.value())}_closeWidget(){this.onDoneButtonClicked.resolve(!1),this._onCloseButtonClicked.fire()}_back(){this.onDoneButtonClicked.resolve(!1),this._onBackButtonClicked.fire()}}var ht=i("8wgr");class dt{constructor(t){this._brokerId="",this._settingsAdapter=t}setBrokerId(t){this._brokerId=t}saveSettings(t){this._settingsAdapter.setValue(this._makeKey(ht.a.ORDER_PANEL_SETTINGS,this._brokerId),JSON.stringify(t))}getSettings(){const t=this._settingsAdapter.getValue(this._makeKey(ht.a.ORDER_PANEL_SETTINGS,this._brokerId));try{return JSON.parse(t)}catch(t){return null}}setWidgetMode(t){this._settingsAdapter.setValue(ht.a.ORDER_WIDGET_MODE,t)}widgetMode(){return this._settingsAdapter.getValue(ht.a.ORDER_WIDGET_MODE)||null}setTakeProfitPips(t,e){const i=this._makeKey(ht.a.TAKE_PROFIT,this._brokerId,t);e===b.b.TakeProfit?this._settingsAdapter.remove(i):this._settingsAdapter.setValue(i,e)}takeProfitPips(t){const e=this._makeKey(ht.a.TAKE_PROFIT,this._brokerId,t),i=Number(this._settingsAdapter.getValue(e));return Object(d.isNumber)(i)?i:null}setStopLossPips(t,e){const i=this._makeKey(ht.a.STOP_LOSS,this._brokerId,t);e===b.b.StopLoss?this._settingsAdapter.remove(i):this._settingsAdapter.setValue(i,e)}stopLossPips(t){const e=this._makeKey(ht.a.STOP_LOSS,this._brokerId,t),i=Number(this._settingsAdapter.getValue(e));return Object(d.isNumber)(i)?i:null}setDuration(t,e){const i=this._makeKey(ht.a.ORDER_DURATION,this._brokerId,t);null===e?this._settingsAdapter.remove(i):this._settingsAdapter.setValue(i,e)}duration(t){const e=this._makeKey(ht.a.ORDER_DURATION,this._brokerId,t),i=this._settingsAdapter.getValue(e);return"string"==typeof i&&i.length>0?{type:i}:null}setCustomFields(t,e){for(const[i,s]of Object.entries(e)){const e=this._makeKey("trading."+i+".",this._brokerId,t);"string"==typeof s&&s.length>0?this._settingsAdapter.setValue(e,s):this._settingsAdapter.remove(e)}}customFields(t,e){const i={};return e.forEach((e=>{const s=this._makeKey("trading."+e+".",this._brokerId,t),r=this._settingsAdapter.getValue(s);"string"==typeof r&&r.length>0&&(i[e]=r)})),i}_makeKey(t,e,i){return t+e+("string"==typeof i?"."+i:"")}}var pt=i("vOQ2"),bt=i("4hvi"),_t=i("NbG7");function ft(){return Promise.all([i.e(4),i.e(14),i.e(16),i.e(18),i.e(20),i.e(22),i.e(26),i.e(32),i.e(41),i.e(45),i.e(56),i.e(67),i.e(77),i.e(87),i.e(91),i.e(108),i.e(3),i.e(7),i.e(17),i.e(29),i.e(53),i.e(52),i.e(69),i.e(83),i.e("order-widget")]).then(i.bind(null,"IkHa"))}function vt(){return Promise.all([i.e(4),i.e(16),i.e(18),i.e(20),i.e(22),i.e(26),i.e(45),i.e(56),i.e(77),i.e(123),i.e(3),i.e(7),i.e(17),i.e(29),i.e(52),i.e(69),i.e("position-widget")]).then(i.bind(null,"CWem"))}i.d(e,"OrderViewController",(function(){return yt}));class yt{constructor(t,e){if(this._state=null,this._mode=new a.a(b.g.Panel),this._orderViewModel=null,this._positionViewModel=null,this._settings=new a.a(_t.c),this._statusChangeIndex=0,this._saveSettingsBinded=this._saveSettings.bind(this),this._orderWidgetStat=null,this._updateContent=t=>{t!==pt.d.OrderPanel&&(this._positionViewModel&&(this._unmountPositionPanel(),this._unsubscribePositionViewModel()),null!==this._orderViewModel&&this._orderViewModel.existingOrder&&this._orderViewModel.onDoneButtonClicked.reject(),this._unmountOrderPanel())},this._onOrderWidgetModeChanged=t=>{null!==this._state&&null!==this._state.broker&&null!==this._orderViewModel&&(this._state.symbol!==this._orderViewModel.symbol?this.showOrderView(this._state.broker,this._orderStub):this._showOrderView()),t===b.g.Panel?this._closePositionDialog():this._closeTradingPanel()},this._onOrderWidgetInputStateChanged=t=>{if(null!==this._state){if(null!==t.takeProfitPips&&this._orderViewDataStorage.setTakeProfitPips(this._state.symbol,t.takeProfitPips),null!==t.stopLossPips&&this._orderViewDataStorage.setStopLossPips(this._state.symbol,t.stopLossPips),t.duration){const e=this._state.broker&&this._state.broker.metainfo().durations,i=e&&(e.find((t=>t.default))||e[0]),s=i&&i.name===t.duration.type?null:t.duration.type;this._orderViewDataStorage.setDuration(this._state.symbol,s)}t.customFields&&this._orderViewDataStorage.setCustomFields(this._state.symbol,t.customFields)}},this._onOrderWidgetCloseButtonClicked=()=>{this._mode.value()===b.g.Panel&&this._closeTradingPanel()},this._onOrderWidgetBackButtonClicked=()=>{null!==this._state&&null!==this._state.broker&&(this._orderViewModel&&this._orderViewModel.status.value()===b.h.Preview?(this._showOrderView(),this._activateOrderPanel()):(this._orderStub=this._createOrderStub(),this.showOrderView(this._state.broker,this._orderStub,void 0,void 0,(()=>{this._mode.value()===b.g.Popup?(this._closeOrderDialog(),this._closePositionDialog()):this._deactivateOrderPanel()}))))},this._onPositionWidgetModeChanged=t=>{null!==this._positionViewModel&&this._showPositionOrTradeView(),t===b.g.Panel?this._closeOrderDialog():this._closeTradingPanel()},this._onPositionWidgetBackButtonClicked=()=>{null!==this._state&&null!==this._state.broker&&(this._mode.value()===b.g.Panel?(this._unmountPositionPanel(),this._showOrderView(void 0,(()=>this._resetOrderPanel()))):this._closePositionDialog())},this._onPositionWidgetCloseButtonClicked=()=>{this._mode.value()===b.g.Panel?(this._unsubscribePositionViewModel(),this._recreateOrderViewModel().then((()=>{this._closePositionPanel(),this._resetOrderPanel()})),this._closeTradingPanel()):this._closePositionDialog()},this._tradingCommands=t,this._trackEvent=t.trackEvent,this._realtimeProvider=t.realtimeProvider,this._resizerBridge=t.resizerBridge,this._orderViewDataStorage=new dt(s),this._tradingPanelContainer=e.container,this._isTradingPanelAvailable=e.isAvailable,this._isTradingPanelOpened=e.isOpened,this._tradingPanelActivePage=e.activePage,this._closeTradingPanel=e.close,this._openTradingPanelPage=e.openPage,e.isAvailable.value())if(n.enabled("order_panel")){const t=this._orderViewDataStorage.widgetMode();this._mode.setValue(null!==t?t:b.g.Panel)}else this._mode.setValue(b.g.Popup);else this._mode.setValue(b.g.Popup);e.isAvailable.subscribe((t=>{t||this._mode.value()!==b.g.Panel||(e.close(),this._mode.setValue(b.g.Popup))})),this._realtimeProvider.onStatusChanged.subscribe(null,(()=>this._onStatusChanged())),r.linking.proSymbol.subscribe((()=>{this._mode.value()===b.g.Popup&&this._closeOrderDialog(),this._onStatusChanged()})),window.loginStateChange&&window.loginStateChange.subscribe(this,this._onStatusChanged),this._settings.subscribe(this._saveSettingsBinded),this._onStatusChanged(),this._orderViewDataStorage.setWidgetMode(this._mode.value()),e.activePage.subscribe(this._updateContent),this.stateChanging=this._createStateChanging()}openPanel(){return this._closeOrderDialog(),this._closePositionDialog(),this._mode.setValue(b.g.Panel),null!==this._positionViewModel?(this._positionViewModel.onDoneButtonClicked.reject(),this._recreateOrderViewModel().then((()=>{this._openOrderPanel(),this._resetOrderPanel(),this._unsubscribePositionViewModel()}))):null!==this._orderViewModel&&this._orderViewModel.existingOrder?(this._orderViewModel.onDoneButtonClicked.reject(),this._unsubscribeOrderViewModel(),this._recreateOrderViewModel().then((()=>{this._openOrderPanel(),this._resetOrderPanel()}))):(this._openOrderPanel(),this._resetOrderPanel(),Promise.resolve())}closePanel(){null!==this._positionViewModel?(this._positionViewModel.onDoneButtonClicked.reject(),this._closePositionPanel(),this._unsubscribePositionViewModel()):(null!==this._orderViewModel&&this._orderViewModel.existingOrder&&(this._orderViewModel.onDoneButtonClicked.reject(),this._unsubscribeOrderViewModel(),this._recreateOrderViewModel()),this._closeOrderPanel())}async showOrderView(t,e,i,s,r){const n=await t.isTradable(e.symbol);if(!n.tradable&&this._mode.value()===b.g.Popup)return Object(bt.a)({isTradableResult:n,activeBroker:t}),!1;null!==this._orderViewModel&&(this._orderViewModel.existingOrder&&this._orderViewModel.onDoneButtonClicked.reject(),this._unsubscribeOrderViewModel());const u=e.hasOwnProperty("id")?t.modifyOrder:t.placeOrder;let a;this._orderStub=Object.assign(this._createOrderStub(),e),s&&this._mode.setValue(b.g.Popup),n.tradable&&(a=await this._getInputStateFromStorage()),a&&Object.assign(a,{stopLossPips:e.stopLoss||a.stopLossPips,takeProfitPips:e.takeProfit||a.takeProfitPips});const l=new nt(t,e,u.bind(t),this._mode,this._settings,n,this._isTradingPanelAvailable.value(),this._tradingCommands.toggleTradingWidget,this._tradingCommands.onNeedSelectBroker,this._tradingCommands.trackEvent,this._orderWidgetStat,this._tradingCommands.showErrorNotification,this._tradingCommands.suggestedQty,a,!0);return this._orderViewModel=l,Object(o.ensureNotNull)(this._orderViewModel).onReady.then((()=>this._orderViewModel!==l?Promise.resolve(!1):(null!==this._positionViewModel&&this._unsubscribePositionViewModel(),this._subscribeOrderViewModel(),this._showOrderView(i,r,s))))}showPositionView(t,e,i,s){return this._createAndShowPositionOrTradeView(t,e,i,t.editPositionBrackets.bind(t),s)}showTradeView(t,e,i,s){return this._createAndShowPositionOrTradeView(t,e,i,t.editTradeBrackets.bind(t),s)}mode(){return this._mode}status(){return Object(o.ensureNotNull)(this._orderViewModel).status.value()}orderViewDataStorage(){return this._orderViewDataStorage}_createAndShowPositionOrTradeView(t,e,i,s,r){null!==this._positionViewModel&&(this._unmountPositionPanel(),this._unsubscribePositionViewModel()),null!==this._orderViewModel&&this._orderViewModel.existingOrder&&(this._orderViewModel.onDoneButtonClicked.reject(),this._recreateOrderViewModel());const n=new ct(t,e,i,s.bind(t),this._mode,this._settings,this._isTradingPanelAvailable.value(),this._tradingCommands.realtimeProvider,this._tradingCommands.trackEvent);return this._positionViewModel=n,Object(o.ensureNotNull)(this._positionViewModel).onReady.then((()=>this._positionViewModel!==n?Promise.resolve(!1):(this._subscribePositionViewModel(),this._showPositionOrTradeView(r))))}_showPositionOrTradeView(t){return null===this._positionViewModel?Promise.resolve(!1):Object(o.ensureNotNull)(this._positionViewModel).onReady.then((()=>(this._mode.value()===b.g.Panel?this._openPositionPanel(t):this._showPositionDialog(t),this._orderViewDataStorage.setWidgetMode(this._mode.value()),Object(o.ensureNotNull)(this._positionViewModel).onDoneButtonClicked.promise.then((t=>t)))))}_showOrderView(t,e,i){return null===this._orderViewModel?Promise.resolve(!1):Object(o.ensureNotNull)(this._orderViewModel).onReady.then((()=>(this._mode.value()===b.g.Panel?this._openOrderPanel(t):this._showOrderDialog(t),this._orderViewDataStorage.setWidgetMode(this._mode.value()),"function"==typeof e&&e(),Object(o.ensureNotNull)(this._orderViewModel).onDoneButtonClicked.promise.then((t=>t)))))}async _onStatusChanged(){var t;const e=++this._statusChangeIndex,i=r.linking.proSymbol.value()||r.linking.symbol.value(),s=this._realtimeProvider.activeBroker(),n=this._state;let u=null;const a=s?s.metainfo().configFlags:null;if(a&&(u=(a.supportLimitOrders?1:a.supportMarketOrders&&2)||a.supportStopOrders&&3||a.supportStopLimitOrders&&4||null),this._orderViewDataStorage.setBrokerId(s?s.metainfo().id:""),this._state={broker:s,symbol:i,side:(null===(t=this._orderViewModel)||void 0===t?void 0:t.side())||1,orderType:null!==this._orderViewModel&&this._orderViewModel.orderType?this._orderViewModel.orderType.value():u,accountId:null!==s?s.currentAccount():null},this._orderStub=this._createOrderStub(),null!==this._orderViewModel&&(this._orderViewModel.existingOrder&&this._orderViewModel.onDoneButtonClicked.reject(),this._unsubscribeOrderViewModel()),null!==this._positionViewModel&&(this._positionViewModel.onDoneButtonClicked.reject(),this._unsubscribePositionViewModel()),!n||n.broker===this._state.broker&&n.accountId===this._state.accountId||(await Promise.all([this._closeOrderDialog(),this._closePositionDialog(),this._unmountPositionPanel()]),e===this._statusChangeIndex))if(null===s){const t=new nt(s,this._orderStub,(()=>Promise.resolve(!0)),this._mode,this._settings,{tradable:!1},this._isTradingPanelAvailable.value(),this._tradingCommands.toggleTradingWidget,this._tradingCommands.onNeedSelectBroker,this._tradingCommands.trackEvent,this._orderWidgetStat,this._tradingCommands.showErrorNotification,this._tradingCommands.suggestedQty);if(this._orderViewModel=t,await Object(o.ensureNotNull)(this._orderViewModel).onReady,e!==this._statusChangeIndex||this._orderViewModel!==t)return;this._subscribeOrderViewModel(),this._deactivateOrderPanel(),this._isTradingPanelOpened.value()&&this._mode.value()===b.g.Panel&&null===this._positionViewModel&&this._tradingPanelActivePage.value()===pt.d.OrderPanel&&this._showOrderView()}else{this._initializeSettings();const t=await s.isTradable(i);let r;if(t.tradable&&(r=await this._getInputStateFromStorage()),e!==this._statusChangeIndex)return;const n=new nt(s,this._orderStub,s.placeOrder.bind(s),this._mode,this._settings,t,this._isTradingPanelAvailable.value(),this._tradingCommands.toggleTradingWidget,this._tradingCommands.onNeedSelectBroker,this._tradingCommands.trackEvent,this._orderWidgetStat,this._tradingCommands.showErrorNotification,this._tradingCommands.suggestedQty,r);if(this._orderViewModel=n,await Object(o.ensureNotNull)(this._orderViewModel).onReady,this._orderViewModel!==n)return;this._resetOrderPanel(),this._deactivateOrderPanel(),this._subscribeOrderViewModel(),this._isTradingPanelOpened.value()&&this._mode.value()===b.g.Panel&&null===this._positionViewModel&&this._tradingPanelActivePage.value()===pt.d.OrderPanel&&this._showOrderView()}}_initializeSettings(){this._settings.unsubscribe(this._saveSettingsBinded);const t=!0===Object(o.ensureNotNull)(this._realtimeProvider.activeBroker()).metainfo().configFlags.supportCryptoBrackets;let e=this._orderViewDataStorage.getSettings()||_t.c;t&&(e=Object.assign({},_t.b,e)),this._settings.setValue(e),this._settings.subscribe(this._saveSettingsBinded)}_saveSettings(t){this._orderViewDataStorage.saveSettings(t)}_createOrderStub(){const t=Object(o.ensureNotNull)(this._state),e={limitPrice:0,stopPrice:0,qty:0,side:t.side,symbol:t.symbol,type:null!==t.orderType?t.orderType:1,takeProfit:void 0,stopLoss:void 0},i=this._orderViewDataStorage.duration(t.symbol);return null!==i&&(e.duration=i),e}_activateOrderPanel(){null!==this._orderViewModel&&this._orderViewModel.activateOrderPanel()}_deactivateOrderPanel(){null!==this._orderViewModel&&this._orderViewModel.deactivateOrderPanel()}_resetOrderPanel(){null!==this._orderViewModel&&this._orderViewModel.resetOrderPanel()}async _recreateOrderViewModel(){if(null!==this._state&&null!==this._state.broker){this._orderStub=this._createOrderStub(),this._orderViewDataStorage.setBrokerId(this._state.broker.metainfo().id);const t=await this._state.broker.isTradable(this._state.symbol);let e;t.tradable&&(e=await this._getInputStateFromStorage());const i=new nt(this._state.broker,this._orderStub,this._state.broker.placeOrder.bind(this._state.broker),this._mode,this._settings,t,this._isTradingPanelAvailable.value(),this._tradingCommands.toggleTradingWidget,this._tradingCommands.onNeedSelectBroker,this._tradingCommands.trackEvent,this._orderWidgetStat,this._tradingCommands.showErrorNotification,this._tradingCommands.suggestedQty,e);return this._orderViewModel=i,this._subscribeOrderViewModel(),i.onReady}}_openOrderPanel(t){return this._mountOrderPanel(t).then((()=>this._openTradingPanelPage(pt.d.OrderPanel)))}_mountOrderPanel(t){return ft().then((e=>{null!==this._orderViewModel&&e.mountOrderPanel(this._orderViewModel,this._settings,this._tradingPanelContainer,Object(o.ensureNotNull)(this._resizerBridge).width,t,this._trackEvent)}))}_closeOrderPanel(){return this._unmountOrderPanel().then((()=>this._closeTradingPanel()))}_unmountOrderPanel(){return ft().then((t=>{t.unmountOrderPanel(Object(o.ensureNotNull)(this._tradingPanelContainer))}))}_showOrderDialog(t){ft().then((e=>{null!==this._orderViewModel&&e.showOrderDialog(this._orderViewModel,this._settings,t,this._trackEvent)}))}_closeOrderDialog(){return ft().then((t=>{t.closeOrderDialog()}))}_subscribeOrderViewModel(){Object(o.ensureNotNull)(this._orderViewModel).onModeChanged().subscribe(this,this._onOrderWidgetModeChanged),Object(o.ensureNotNull)(this._orderViewModel).onInputStateChanged().subscribe(this,this._onOrderWidgetInputStateChanged),Object(o.ensureNotNull)(this._orderViewModel).onCloseButtonClicked().subscribe(this,this._onOrderWidgetCloseButtonClicked),Object(o.ensureNotNull)(this._orderViewModel).onBackButtonClicked().subscribe(this,this._onOrderWidgetBackButtonClicked)}_unsubscribeOrderViewModel(){Object(o.ensureNotNull)(this._orderViewModel).onModeChanged().unsubscribe(this,this._onOrderWidgetModeChanged),Object(o.ensureNotNull)(this._orderViewModel).onInputStateChanged().unsubscribe(this,this._onOrderWidgetInputStateChanged),Object(o.ensureNotNull)(this._orderViewModel).onCloseButtonClicked().unsubscribe(this,this._onOrderWidgetCloseButtonClicked),Object(o.ensureNotNull)(this._orderViewModel).onBackButtonClicked().unsubscribe(this,this._onOrderWidgetBackButtonClicked),Object(o.ensureNotNull)(this._orderViewModel).destroy(),this._orderViewModel=null}_openPositionPanel(t){return this._mountPositionPanel(t).then((()=>this._openTradingPanelPage(pt.d.OrderPanel)))}_mountPositionPanel(t){return vt().then((e=>{if(null!==this._positionViewModel)return e.mountPositionPanel(this._positionViewModel,this._settings,this._tradingPanelContainer,t)}))}_closePositionPanel(){return this._unmountPositionPanel().then((()=>this._closeTradingPanel()))}_unmountPositionPanel(){return vt().then((t=>{null!==this._positionViewModel&&t.unmountPositionPanel(this._positionViewModel,this._tradingPanelContainer)}))}_showPositionDialog(t){vt().then((e=>{null!==this._positionViewModel&&e.showPositionDialog(this._positionViewModel,this._settings,t)}))}_closePositionDialog(){return vt().then((t=>{t.closePositionDialog()}))}_subscribePositionViewModel(){Object(o.ensureNotNull)(this._positionViewModel).onModeChanged().subscribe(this,this._onPositionWidgetModeChanged),Object(o.ensureNotNull)(this._positionViewModel).onBackButtonClicked().subscribe(this,this._onPositionWidgetBackButtonClicked),Object(o.ensureNotNull)(this._positionViewModel).onCloseButtonClicked().subscribe(this,this._onPositionWidgetCloseButtonClicked)}_unsubscribePositionViewModel(){Object(o.ensureNotNull)(this._positionViewModel).onModeChanged().unsubscribe(this,this._onPositionWidgetModeChanged),Object(o.ensureNotNull)(this._positionViewModel).onBackButtonClicked().unsubscribe(this,this._onPositionWidgetBackButtonClicked),Object(o.ensureNotNull)(this._positionViewModel).onCloseButtonClicked().unsubscribe(this,this._onPositionWidgetCloseButtonClicked),Object(o.ensureNotNull)(this._positionViewModel).onDoneButtonClicked.resolve(!1),Object(o.ensureNotNull)(this._positionViewModel).destroy(),this._positionViewModel=null}_createStateChanging(){const t=new a.a(!1);this.stateChanging=t;const e=this._onStatusChanged;let i=0;return this._onStatusChanged=()=>(t.setValue(!0),i++,e.call(this).then((()=>{i--,t.setValue(0!==i)})).catch((e=>{throw i--,t.setValue(0!==i),e}))),t}async _getInputStateFromStorage(){var t;if(null===this._state)return;let e;const i=await(null===(t=this._state.broker)||void 0===t?void 0:t.getOrderDialogOptions(this._state.symbol));return i&&i.customFields&&(e=this._orderViewDataStorage.customFields(this._state.symbol,i.customFields.map((t=>t.id)))),{symbol:this._state.symbol,side:this._state.side,limitPrice:null,stopPrice:null,quantity:null,takeProfitPips:this._orderViewDataStorage.takeProfitPips(this._state.symbol),stopLossPips:this._orderViewDataStorage.stopLossPips(this._state.symbol),duration:null,customFields:e||null}}}},"3oOo":function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=i("8yf6"),o=i("4c1C"),n=i("rfFC"),u=i("NTzu"),a=i("wHNh"),l=function(t){function e(e,i){t.call(this),this.source=e,this.subjectFactory=i,this._refCount=0,this._isComplete=!1}return s(e,t),e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},e.prototype.connect=function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new u.Subscription).add(this.source.subscribe(new h(this.getSubject(),this))),t.closed?(this._connection=null,t=u.Subscription.EMPTY):this._connection=t),t},e.prototype.refCount=function(){return a.refCount()(this)},e}(o.Observable);e.ConnectableObservable=l;var c=l.prototype;e.connectableObservableDescriptor={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:c._subscribe},_isComplete:{value:c._isComplete,writable:!0},getSubject:{value:c.getSubject},connect:{value:c.connect},refCount:{value:c.refCount}};var h=function(t){function e(e,i){t.call(this,e),this.connectable=i}return s(e,t),e.prototype._error=function(e){this._unsubscribe(),t.prototype._error.call(this,e)},e.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}},e}(r.SubjectSubscriber);!function(t){function e(e,i){t.call(this,e),this.connectable=i}s(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var i=this.connection,s=t._connection;this.connection=null,!s||i&&s!==i||s.unsubscribe()}}else this.connection=null}}(n.Subscriber)},"4XzM":function(t,e,i){"use strict";var s=i("4c1C"),r=i("+EyI");s.Observable.prototype.map=r.map},"5NPC":function(t,e,i){"use strict";var s=i("8yf6"),r=i("xE8I");e.publish=function(t){return t?r.multicast((function(){return new s.Subject}),t):r.multicast(new s.Subject)}},"9A11":function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=i("rfFC"),o=i("ty+v");e.first=function(t,e,i){return function(s){return s.lift(new n(t,e,i,s))}};var n=function(){function t(t,e,i,s){this.predicate=t,this.resultSelector=e,this.defaultValue=i,this.source=s}return t.prototype.call=function(t,e){return e.subscribe(new u(t,this.predicate,this.resultSelector,this.defaultValue,this.source))},t}(),u=function(t){function e(e,i,s,r,o){t.call(this,e),this.predicate=i,this.resultSelector=s,this.defaultValue=r,this.source=o,this.index=0,this.hasCompleted=!1,this._emitted=!1}return s(e,t),e.prototype._next=function(t){var e=this.index++;this.predicate?this._tryPredicate(t,e):this._emit(t,e)},e.prototype._tryPredicate=function(t,e){var i;try{i=this.predicate(t,e,this.source)}catch(t){return void this.destination.error(t)}i&&this._emit(t,e)},e.prototype._emit=function(t,e){this.resultSelector?this._tryResultSelector(t,e):this._emitFinal(t)},e.prototype._tryResultSelector=function(t,e){var i;try{i=this.resultSelector(t,e)}catch(t){return void this.destination.error(t)}this._emitFinal(i)},e.prototype._emitFinal=function(t){var e=this.destination;this._emitted||(this._emitted=!0,e.next(t),e.complete(),this.hasCompleted=!0)},e.prototype._complete=function(){var t=this.destination;this.hasCompleted||void 0===this.defaultValue?this.hasCompleted||t.error(new o.EmptyError):(t.next(this.defaultValue),t.complete())},e}(r.Subscriber)},"9zIo":function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=function(t){function e(){t.apply(this,arguments)}return s(e,t),e}(i("xA5P").AsyncScheduler);e.QueueScheduler=r},C7Jb:function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=function(t){function e(e,i){t.call(this)}return s(e,t),e.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},e}(i("NTzu").Subscription);e.Action=r},DVyt:function(t,e,i){"use strict";var s=i("HDK4"),r=i("xE8I");e.publishReplay=function(t,e,i,o){i&&"function"!=typeof i&&(o=i);var n="function"==typeof i?i:void 0,u=new s.ReplaySubject(t,e,o);return function(t){return r.multicast((function(){return u}),n)(t)}}},G4OQ:function(t,e,i){"use strict";var s=i("rRE7");e.of=s.ArrayObservable.of},G7k4:function(t,e,i){"use strict";var s=i("4c1C"),r=i("gjxa");s.Observable.prototype.publish=r.publish},H9Zw:function(t,e,i){"use strict";var s=i("z6YP"),r=i("G4OQ"),o=i("IrFB"),n=i("Rcwy");e.concat=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return 1===t.length||2===t.length&&s.isScheduler(t[1])?o.from(t[0]):n.concatAll()(r.of.apply(void 0,t))}},HDK4:function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=i("8yf6"),o=i("1ouX"),n=i("NTzu"),u=i("Ndu5"),a=i("VpWK"),l=i("8Zmw"),c=function(t){function e(e,i,s){void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===i&&(i=Number.POSITIVE_INFINITY),t.call(this),this.scheduler=s,this._events=[],this._bufferSize=e<1?1:e,this._windowTime=i<1?1:i}return s(e,t),e.prototype.next=function(e){var i=this._getNow();this._events.push(new h(i,e)),this._trimBufferThenGetEvents(),t.prototype.next.call(this,e)},e.prototype._subscribe=function(t){var e,i=this._trimBufferThenGetEvents(),s=this.scheduler;if(this.closed)throw new a.ObjectUnsubscribedError;this.hasError||this.isStopped?e=n.Subscription.EMPTY:(this.observers.push(t),e=new l.SubjectSubscription(this,t)),s&&t.add(t=new u.ObserveOnSubscriber(t,s));for(var r=i.length,o=0;o<r&&!t.closed;o++)t.next(i[o].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),e},e.prototype._getNow=function(){return(this.scheduler||o.queue).now()},e.prototype._trimBufferThenGetEvents=function(){for(var t=this._getNow(),e=this._bufferSize,i=this._windowTime,s=this._events,r=s.length,o=0;o<r&&!(t-s[o].time<i);)o++;return r>e&&(o=Math.max(o,r-e)),o>0&&s.splice(0,o),s},e}(r.Subject);e.ReplaySubject=c;var h=function(t,e){this.time=t,this.value=e}},IrFB:function(t,e,i){"use strict";var s=i("pHYF");e.from=s.FromObservable.create},JwtW:function(t,e,i){"use strict";var s=i("4c1C"),r=i("oaOn");s.Observable.combineLatest=r.combineLatest},MSNS:function(t,e,i){"use strict";var s=i("4c1C"),r=i("jQCj");s.Observable.prototype.startWith=r.startWith},MiOS:function(t,e,i){"use strict";i.d(e,"b",(function(){return r})),i.d(e,"d",(function(){return o})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){return u})),i.d(e,"e",(function(){return a}));var s=i("ldgD");function r(t,e){return t.find((t=>t.value===e))||t[0]}function o(t){return new Date(t.format("YYYY-MM-DD[T]HH:mm[:00Z]")).valueOf()}function n(t,e){return(e.hasDatePicker?t.format("DD MMM YYYY"):"")+(e.hasTimePicker?", "+t.format("hh:mm A"):"")}function u(t,e){return e.filter((e=>null===t||void 0===e.supportedOrderTypes||e.supportedOrderTypes.includes(t)))}function a(t){const e={type:t.value};var i;return i=t,Boolean(i.hasTimePicker||i.hasDatePicker)&&(e.datetime=o(s().utc().add(1,"days"))),e}},NVK1:function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=i("rfFC");e.map=function(t,e){return function(i){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return i.lift(new o(t,e))}};var o=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new n(t,this.project,this.thisArg))},t}();e.MapOperator=o;var n=function(t){function e(e,i,s){t.call(this,e),this.project=i,this.count=0,this.thisArg=s||this}return s(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(r.Subscriber)},NbG7:function(t,e,i){"use strict";i.d(e,"c",(function(){return r})),i.d(e,"b",(function(){return o})),i.d(e,"a",(function(){return n}));var s=i("q1tI");const r={showRelativePriceControl:!0,showCurrencyRiskInQty:!0,showPercentRiskInQty:!0,showBracketsInCurrency:!0,showBracketsInPercent:!0,showOrderPreview:!0,showCryptoBracketsInCurrency:!1,showCryptoBracketsInPercent:!1},o={showCryptoBracketsInCurrency:!1,showCryptoBracketsInPercent:!1},n=s.createContext({value:r,setValue:t=>{console.warn("unable to modify order ticket settings because context.setValue is not defined")}})},Ndu5:function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=i("rfFC"),o=i("i2Fk");e.observeOn=function(t,e){return void 0===e&&(e=0),function(i){return i.lift(new n(t,e))}};var n=function(){function t(t,e){void 0===e&&(e=0),this.scheduler=t,this.delay=e}return t.prototype.call=function(t,e){return e.subscribe(new u(t,this.scheduler,this.delay))},t}();e.ObserveOnOperator=n;var u=function(t){function e(e,i,s){void 0===s&&(s=0),t.call(this,e),this.scheduler=i,this.delay=s}return s(e,t),e.dispatch=function(t){var e=t.notification,i=t.destination;e.observe(i),this.unsubscribe()},e.prototype.scheduleMessage=function(t){this.add(this.scheduler.schedule(e.dispatch,this.delay,new a(t,this.destination)))},e.prototype._next=function(t){this.scheduleMessage(o.Notification.createNext(t))},e.prototype._error=function(t){this.scheduleMessage(o.Notification.createError(t))},e.prototype._complete=function(){this.scheduleMessage(o.Notification.createComplete())},e}(r.Subscriber);e.ObserveOnSubscriber=u;var a=function(t,e){this.notification=t,this.destination=e};e.ObserveOnMessage=a},PIcZ:function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=function(t){function e(e,i){t.call(this),this.value=e,this.scheduler=i,this._isScalar=!0,i&&(this._isScalar=!1)}return s(e,t),e.create=function(t,i){return new e(t,i)},e.dispatch=function(t){var e=t.done,i=t.value,s=t.subscriber;e?s.complete():(s.next(i),s.closed||(t.done=!0,this.schedule(t)))},e.prototype._subscribe=function(t){var i=this.value,s=this.scheduler;if(s)return s.schedule(e.dispatch,0,{done:!1,value:i,subscriber:t});t.next(i),t.closed||t.complete()},e}(i("4c1C").Observable);e.ScalarObservable=r},Rcwy:function(t,e,i){"use strict";var s=i("XlJg");e.concatAll=function(){return s.mergeAll(1)}},Rkh2:function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=i("tSeh"),o=function(t){function e(e,i){t.call(this),this.promise=e,this.scheduler=i}return s(e,t),e.create=function(t,i){return new e(t,i)},e.prototype._subscribe=function(t){var e=this,i=this.promise,s=this.scheduler;if(null==s)this._isScalar?t.closed||(t.next(this.value),t.complete()):i.then((function(i){e.value=i,e._isScalar=!0,t.closed||(t.next(i),t.complete())}),(function(e){t.closed||t.error(e)})).then(null,(function(t){r.root.setTimeout((function(){throw t}))}));else if(this._isScalar){if(!t.closed)return s.schedule(n,0,{value:this.value,subscriber:t})}else i.then((function(i){e.value=i,e._isScalar=!0,t.closed||t.add(s.schedule(n,0,{value:i,subscriber:t}))}),(function(e){t.closed||t.add(s.schedule(u,0,{err:e,subscriber:t}))})).then(null,(function(t){r.root.setTimeout((function(){throw t}))}))},e}(i("4c1C").Observable);function n(t){var e=t.value,i=t.subscriber;i.closed||(i.next(e),i.complete())}function u(t){var e=t.err,i=t.subscriber;i.closed||i.error(e)}e.PromiseObservable=o},SUh3:function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=function(t){function e(e){t.call(this),this.scheduler=e}return s(e,t),e.create=function(t){return new e(t)},e.dispatch=function(t){t.subscriber.complete()},e.prototype._subscribe=function(t){var i=this.scheduler;if(i)return i.schedule(e.dispatch,0,{subscriber:t});t.complete()},e}(i("4c1C").Observable);e.EmptyObservable=r},VVyh:function(t,e,i){"use strict";i.d(e,"d",(function(){return r})),i.d(e,"b",(function(){return o})),i.d(e,"a",(function(){return n})),i.d(e,"c",(function(){return u}));var s=i("Nkvk");function r(t,e,i){if(e.parse){const i=e.parse(t);if(i.res)return i.value}return void 0!==i?i:parseFloat(t)}function o(t,e,i,s,r){const o=Array.from({length:t},function(t,e,i,s){return(r,o)=>s.format(t+i*e*(o+1))}(e,i,s,r));return 1===s?o.reverse():o}function n(t,e,i,s){return[...o(s,t,e,1,i),i.format(t),...o(s,t,e,-1,i)]}function u(){return"phone"!==s.mediaState.device&&"phone-vertical"!==s.mediaState.device?6:4}},XVkz:function(t,e,i){"use strict";var s=i("0PrS");e.filter=function(t,e){return s.filter(t,e)(this)}},XlJg:function(t,e,i){"use strict";var s=i("ciX6"),r=i("22vd");e.mergeAll=function(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),s.mergeMap(r.identity,null,t)}},ciX6:function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=i("hgAg"),o=i("35Wn");e.mergeMap=function(t,e,i){return void 0===i&&(i=Number.POSITIVE_INFINITY),function(s){return"number"==typeof e&&(i=e,e=null),s.lift(new n(t,e,i))}};var n=function(){function t(t,e,i){void 0===i&&(i=Number.POSITIVE_INFINITY),this.project=t,this.resultSelector=e,this.concurrent=i}return t.prototype.call=function(t,e){return e.subscribe(new u(t,this.project,this.resultSelector,this.concurrent))},t}();e.MergeMapOperator=n;var u=function(t){function e(e,i,s,r){void 0===r&&(r=Number.POSITIVE_INFINITY),t.call(this,e),this.project=i,this.resultSelector=s,this.concurrent=r,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}return s(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,i=this.index++;try{e=this.project(t,i)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(e,t,i)},e.prototype._innerSub=function(t,e,i){this.add(r.subscribeToResult(this,t,e,i))},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete()},e.prototype.notifyNext=function(t,e,i,s,r){this.resultSelector?this._notifyResultSelector(t,e,i,s):this.destination.next(e)},e.prototype._notifyResultSelector=function(t,e,i,s){var r;try{r=this.resultSelector(t,e,i,s)}catch(t){return void this.destination.error(t)}this.destination.next(r)},e.prototype.notifyComplete=function(t){var e=this.buffer;this.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(o.OuterSubscriber);e.MergeMapSubscriber=u},"d/Vi":function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=i("tSeh"),o=i("4c1C"),n=i("p8xl"),u=function(t){function e(e,i){if(t.call(this),this.scheduler=i,null==e)throw new Error("iterator cannot be null.");this.iterator=function(t){var e=t[n.iterator];if(!e&&"string"==typeof t)return new a(t);if(!e&&void 0!==t.length)return new l(t);if(!e)throw new TypeError("object is not iterable");return t[n.iterator]()}(e)}return s(e,t),e.create=function(t,i){return new e(t,i)},e.dispatch=function(t){var e=t.index,i=t.hasError,s=t.iterator,r=t.subscriber;if(i)r.error(t.error);else{var o=s.next();o.done?r.complete():(r.next(o.value),t.index=e+1,r.closed?"function"==typeof s.return&&s.return():this.schedule(t))}},e.prototype._subscribe=function(t){var i=this.iterator,s=this.scheduler;if(s)return s.schedule(e.dispatch,0,{index:0,iterator:i,subscriber:t});for(;;){var r=i.next();if(r.done){t.complete();break}if(t.next(r.value),t.closed){"function"==typeof i.return&&i.return();break}}},e}(o.Observable);e.IteratorObservable=u;var a=function(){function t(t,e,i){void 0===e&&(e=0),void 0===i&&(i=t.length),this.str=t,this.idx=e,this.len=i}return t.prototype[n.iterator]=function(){return this},t.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.str.charAt(this.idx++)}:{done:!0,value:void 0}},t}(),l=function(){function t(t,e,i){void 0===e&&(e=0),void 0===i&&(i=function(t){var e,i=+t.length;return isNaN(i)?0:0!==i&&("number"==typeof(e=i)&&r.root.isFinite(e))?(i=function(t){var e=+t;return 0===e||isNaN(e)?e:e<0?-1:1}(i)*Math.floor(Math.abs(i)))<=0?0:i>c?c:i:i}(t)),this.arr=t,this.idx=e,this.len=i}return t.prototype[n.iterator]=function(){return this},t.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.arr[this.idx++]}:{done:!0,value:void 0}},t}(),c=Math.pow(2,53)-1},en3B:function(t,e,i){"use strict";i.d(e,"h",(function(){return s})),i.d(e,"i",(function(){return r})),i.d(e,"g",(function(){return o})),i.d(e,"a",(function(){return n})),i.d(e,"k",(function(){return u})),i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return l})),i.d(e,"l",(function(){return c})),i.d(e,"j",(function(){return h})),i.d(e,"d",(function(){return d})),i.d(e,"e",(function(){return p})),i.d(e,"f",(function(){return _})),i.d(e,"m",(function(){return f}));var s,r,o,n,u,a,l,c,h,d,p,b=i("q1tI");!function(t){t[t.Wait=0]="Wait",t[t.Active=1]="Active",t[t.Editing=2]="Editing",t[t.Preview=3]="Preview"}(s||(s={})),function(t){t[t.Creating=0]="Creating",t[t.Placed=1]="Placed"}(r||(r={})),function(t){t.Popup="popup",t.Panel="panel"}(o||(o={})),function(t){t[t.StopLoss=0]="StopLoss",t[t.TakeProfit=1]="TakeProfit",t[t.TrailingStop=2]="TrailingStop"}(n||(n={})),function(t){t[t.Stop=0]="Stop",t[t.Limit=1]="Limit"}(u||(u={})),function(t){t[t.TakeProfit=75]="TakeProfit",t[t.StopLoss=25]="StopLoss"}(a||(a={})),function(t){t.Price="Price",t.Pips="Pips",t.Money="Money",t.Percent="Percent"}(l||(l={})),function(t){t.Units="Units",t.RiskInCurrency="RiskInCurrency",t.RiskInPercent="RiskInPercent",t.BaseCurrency="BaseCurrency",t.QuoteCurrency="QuoteCurrency"}(c||(c={})),function(t){t.Absolute="Absolute",t.Relative="Relative"}(h||(h={})),function(t){t[t.Minus=189]="Minus",t[t.NumMinus=109]="NumMinus",t[t.FirefoxMinus=173]="FirefoxMinus"}(d||(d={})),function(t){t[t.Plus=187]="Plus",t[t.NumPlus=107]="NumPlus",t[t.FirefoxPlus=61]="FirefoxPlus"}(p||(p={}));const _=b.createContext({resizerWidth:null,mode:o.Panel,supportTrailingStop:!1}),f={1:window.t("Limit"),2:window.t("Market"),3:window.t("Stop"),4:window.t("Stop Limit")}},fLIW:function(t,e,i){"use strict";var s=i("DVyt");e.publishReplay=function(t,e,i,r){return s.publishReplay(t,e,i,r)(this)}},fjAU:function(t,e,i){"use strict";var s=i("4c1C"),r=i("XVkz");s.Observable.prototype.filter=r.filter},gjxa:function(t,e,i){"use strict";var s=i("5NPC");e.publish=function(t){return s.publish(t)(this)}},gxrE:function(t,e,i){"use strict";var s=i("4c1C"),r=i("lKtV");s.Observable.prototype.first=r.first},hDVK:function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=i("rRE7"),o=i("luwt"),n=i("35Wn"),u=i("hgAg"),a={};e.combineLatest=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var i=null;return"function"==typeof t[t.length-1]&&(i=t.pop()),1===t.length&&o.isArray(t[0])&&(t=t[0].slice()),function(e){return e.lift.call(new r.ArrayObservable([e].concat(t)),new l(i))}};var l=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new c(t,this.project))},t}();e.CombineLatestOperator=l;var c=function(t){function e(e,i){t.call(this,e),this.project=i,this.active=0,this.values=[],this.observables=[]}return s(e,t),e.prototype._next=function(t){this.values.push(a),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var i=0;i<e;i++){var s=t[i];this.add(u.subscribeToResult(this,s,s,i))}}},e.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},e.prototype.notifyNext=function(t,e,i,s,r){var o=this.values,n=o[i],u=this.toRespond?n===a?--this.toRespond:this.toRespond:0;o[i]=e,0===u&&(this.project?this._tryProject(o):this.destination.next(o.slice()))},e.prototype._tryProject=function(t){var e;try{e=this.project.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(n.OuterSubscriber);e.CombineLatestSubscriber=c},hgAg:function(t,e,i){"use strict";var s=i("tSeh"),r=i("vf56"),o=i("/Trf"),n=i("rkVw"),u=i("4c1C"),a=i("p8xl"),l=i("nFJ+"),c=i("78uX");e.subscribeToResult=function(t,e,i,h){var d=new l.InnerSubscriber(t,i,h);if(d.closed)return null;if(e instanceof u.Observable)return e._isScalar?(d.next(e.value),d.complete(),null):(d.syncErrorThrowable=!0,e.subscribe(d));if(r.isArrayLike(e)){for(var p=0,b=e.length;p<b&&!d.closed;p++)d.next(e[p]);d.closed||d.complete()}else{if(o.isPromise(e))return e.then((function(t){d.closed||(d.next(t),d.complete())}),(function(t){return d.error(t)})).then(null,(function(t){s.root.setTimeout((function(){throw t}))})),d;if(e&&"function"==typeof e[a.iterator])for(var _=e[a.iterator]();;){var f=_.next();if(f.done){d.complete();break}if(d.next(f.value),d.closed)break}else if(e&&"function"==typeof e[c.observable]){var v=e[c.observable]();if("function"==typeof v.subscribe)return v.subscribe(new l.InnerSubscriber(t,i,h));d.error(new TypeError("Provided object does not correctly implement Symbol.observable"))}else{var y="You provided "+(n.isObject(e)?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";d.error(new TypeError(y))}}return null}},i2Fk:function(t,e,i){"use strict";var s=i("4c1C"),r=function(){function t(t,e,i){this.kind=t,this.value=e,this.error=i,this.hasValue="N"===t}return t.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},t.prototype.do=function(t,e,i){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return i&&i()}},t.prototype.accept=function(t,e,i){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,i)},t.prototype.toObservable=function(){switch(this.kind){case"N":return s.Observable.of(this.value);case"E":return s.Observable.throw(this.error);case"C":return s.Observable.empty()}throw new Error("unexpected notification kind value")},t.createNext=function(e){return void 0!==e?new t("N",e):t.undefinedValueNotification},t.createError=function(e){return new t("E",void 0,e)},t.createComplete=function(){return t.completeNotification},t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t}();e.Notification=r},iLVi:function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=i("4c1C"),o=i("PIcZ"),n=i("SUh3"),u=function(t){function e(e,i){t.call(this),this.arrayLike=e,this.scheduler=i,i||1!==e.length||(this._isScalar=!0,this.value=e[0])}return s(e,t),e.create=function(t,i){var s=t.length;return 0===s?new n.EmptyObservable:1===s?new o.ScalarObservable(t[0],i):new e(t,i)},e.dispatch=function(t){var e=t.arrayLike,i=t.index,s=t.length,r=t.subscriber;r.closed||(i>=s?r.complete():(r.next(e[i]),t.index=i+1,this.schedule(t)))},e.prototype._subscribe=function(t){var i=this.arrayLike,s=this.scheduler,r=i.length;if(s)return s.schedule(e.dispatch,0,{arrayLike:i,index:0,length:r,subscriber:t});for(var o=0;o<r&&!t.closed;o++)t.next(i[o]);t.complete()},e}(r.Observable);e.ArrayLikeObservable=u},jQCj:function(t,e,i){"use strict";var s=i("+AwB");e.startWith=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return s.startWith.apply(void 0,t)(this)}},jjUP:function(t,e,i){"use strict";i.d(e,"e",(function(){return o})),i.d(e,"f",(function(){return n})),i.d(e,"a",(function(){return u})),i.d(e,"b",(function(){return a})),i.d(e,"d",(function(){return l})),i.d(e,"c",(function(){return c})),i("YFKU");var s=i("ivNn"),r=i("nc0P");function o(t,e,i,r,o){if(!e)return 0;const n=t/(e*i*(o||1));return Math.floor(Object(s.fixComputationError)(n/r*r))}function n(t,e,i,r,o,n){if(!i)return 0;const u=t*e/(i*r*(n||1)*100);return Math.floor(Object(s.fixComputationError)(u/o*o))}function u(t,e,i,r){return Object(s.fixComputationError)(e*i*t*(r||1))}function a(t,e,i,r,o){return r&&t?Object(s.fixComputationError)(e*i*t*(o||1)*100/r):0}const l={min:window.t("Specified amount is less than the instrument minimum of {0}."),max:window.t("Specified amount is more than the instrument maximum of {0}."),step:window.t("Specified amount is not a multiple of the instrument quantity step of {0}."),balance:window.t("Your value exceeds the acceptable balance level.")};function c(t,e,i=!1){if(null===e)return{res:!0};const s=t.step,o=t.min,n=t.max;if(e<o)return{res:!0,msg:l.min.format(o)};if(e>n)return{res:!0,msg:l.max.format(n)};const u=new r.Big(e),a=new r.Big(s),c=u.mod(a);return i&&!c.eq(0)?{res:!0,msg:l.step.format(s)}:{res:!1}}},lKtV:function(t,e,i){"use strict";var s=i("9A11");e.first=function(t,e,i){return s.first(t,e,i)(this)}},"m4/a":function(t,e,i){"use strict";var s=function(){function t(e,i){void 0===i&&(i=t.now),this.SchedulerAction=e,this.now=i}return t.prototype.schedule=function(t,e,i){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(i,e)},t.now=Date.now?Date.now:function(){return+new Date},t}();e.Scheduler=s},"m6W+":function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var s=i("EBrf"),r=i("Ialn");class o{constructor(t=" "){this._divider=t}format(t){const e=Object(s.splitThousands)(t,this._divider);return Object(r.isRtl)()?Object(r.startWithLTR)(e):e}parse(t){const e=Object(r.stripLTRMarks)(t).split(this._divider).join(""),i=Number(e);return isNaN(i)||/e/i.test(e)?{res:!1}:{res:!0,value:i,suggest:this.format(i)}}}},mPU7:function(t,e,i){"use strict";var s=i("4c1C"),r=i("fLIW");s.Observable.prototype.publishReplay=r.publishReplay},"nFJ+":function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=function(t){function e(e,i,s){t.call(this),this.parent=e,this.outerValue=i,this.outerIndex=s,this.index=0}return s(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(i("rfFC").Subscriber);e.InnerSubscriber=r},oaOn:function(t,e,i){"use strict";var s=i("z6YP"),r=i("luwt"),o=i("rRE7"),n=i("hDVK");e.combineLatest=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var i=null,u=null;return s.isScheduler(t[t.length-1])&&(u=t.pop()),"function"==typeof t[t.length-1]&&(i=t.pop()),1===t.length&&r.isArray(t[0])&&(t=t[0]),new o.ArrayObservable(t,u).lift(new n.CombineLatestOperator(i))}},p8xl:function(t,e,i){"use strict";var s=i("tSeh");function r(t){var e=t.Symbol;if("function"==typeof e)return e.iterator||(e.iterator=e("iterator polyfill")),e.iterator;var i=t.Set;if(i&&"function"==typeof(new i)["@@iterator"])return"@@iterator";var s=t.Map;if(s)for(var r=Object.getOwnPropertyNames(s.prototype),o=0;o<r.length;++o){var n=r[o];if("entries"!==n&&"size"!==n&&s.prototype[n]===s.prototype.entries)return n}return"@@iterator"}e.symbolIteratorPonyfill=r,e.iterator=r(s.root),e.$$iterator=e.iterator},pHYF:function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=i("luwt"),o=i("vf56"),n=i("/Trf"),u=i("Rkh2"),a=i("d/Vi"),l=i("rRE7"),c=i("iLVi"),h=i("p8xl"),d=i("4c1C"),p=i("Ndu5"),b=i("78uX"),_=function(t){function e(e,i){t.call(this,null),this.ish=e,this.scheduler=i}return s(e,t),e.create=function(t,i){if(null!=t){if("function"==typeof t[b.observable])return t instanceof d.Observable&&!i?t:new e(t,i);if(r.isArray(t))return new l.ArrayObservable(t,i);if(n.isPromise(t))return new u.PromiseObservable(t,i);if("function"==typeof t[h.iterator]||"string"==typeof t)return new a.IteratorObservable(t,i);if(o.isArrayLike(t))return new c.ArrayLikeObservable(t,i)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")},e.prototype._subscribe=function(t){var e=this.ish,i=this.scheduler;return null==i?e[b.observable]().subscribe(t):e[b.observable]().subscribe(new p.ObserveOnSubscriber(t,i,0))},e}(d.Observable);e.FromObservable=_},qoI1:function(t,e,i){var s={"./en-gb":"Oaa7","./en-gb.js":"Oaa7","./es":"iYuL","./es.js":"iYuL","./it":"bpih","./it.js":"bpih","./ja":"B55N","./ja.js":"B55N","./ko":"Ivi+","./ko.js":"Ivi+","./pl":"jVdC","./pl.js":"jVdC","./pt":"8mBD","./pt-br":"0tRk","./pt-br.js":"0tRk","./pt.js":"8mBD","./ru":"lXzo","./ru.js":"lXzo","./tr":"DoHr","./tr.js":"DoHr"};function r(t){var e=o(t);return i(e)}function o(t){if(!i.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}r.keys=function(){return Object.keys(s)},r.resolve=o,t.exports=r,r.id="qoI1"},rRE7:function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=i("4c1C"),o=i("PIcZ"),n=i("SUh3"),u=i("z6YP"),a=function(t){function e(e,i){t.call(this),this.array=e,this.scheduler=i,i||1!==e.length||(this._isScalar=!0,this.value=e[0])}return s(e,t),e.create=function(t,i){return new e(t,i)},e.of=function(){for(var t=[],i=0;i<arguments.length;i++)t[i-0]=arguments[i];var s=t[t.length-1];u.isScheduler(s)?t.pop():s=null;var r=t.length;return r>1?new e(t,s):1===r?new o.ScalarObservable(t[0],s):new n.EmptyObservable(s)},e.dispatch=function(t){var e=t.array,i=t.index,s=t.count,r=t.subscriber;i>=s?r.complete():(r.next(e[i]),r.closed||(t.index=i+1,this.schedule(t)))},e.prototype._subscribe=function(t){var i=this.array,s=i.length,r=this.scheduler;if(r)return r.schedule(e.dispatch,0,{array:i,index:0,count:s,subscriber:t});for(var o=0;o<s&&!t.closed;o++)t.next(i[o]);t.complete()},e}(r.Observable);e.ArrayObservable=a},srUj:function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=i("xqEh"),o=i("4c1C"),n=i("NTzu"),u=function(t){function e(e,i,s){t.call(this),this.addHandler=e,this.removeHandler=i,this.selector=s}return s(e,t),e.create=function(t,i,s){return new e(t,i,s)},e.prototype._subscribe=function(t){var e=this,i=this.removeHandler,s=this.selector?function(){for(var i=[],s=0;s<arguments.length;s++)i[s-0]=arguments[s];e._callSelector(t,i)}:function(e){t.next(e)},o=this._callAddHandler(s,t);r.isFunction(i)&&t.add(new n.Subscription((function(){i(s,o)})))},e.prototype._callSelector=function(t,e){try{var i=this.selector.apply(this,e);t.next(i)}catch(e){t.error(e)}},e.prototype._callAddHandler=function(t,e){try{return this.addHandler(t)||null}catch(t){e.error(t)}},e}(o.Observable);e.FromEventPatternObservable=u},"ty+v":function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=function(t){function e(){var e=t.call(this,"no elements in sequence");this.name=e.name="EmptyError",this.stack=e.stack,this.message=e.message}return s(e,t),e}(Error);e.EmptyError=r},"u+1n":function(t,e,i){"use strict";var s=i("srUj");e.fromEventPattern=s.FromEventPatternObservable.create},vf56:function(t,e,i){"use strict";e.isArrayLike=function(t){return t&&"number"==typeof t.length}},wHNh:function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=i("rfFC");e.refCount=function(){return function(t){return t.lift(new o(t))}};var o=function(){function t(t){this.connectable=t}return t.prototype.call=function(t,e){var i=this.connectable;i._refCount++;var s=new n(t,i),r=e.subscribe(s);return s.closed||(s.connection=i.connect()),r},t}(),n=function(t){function e(e,i){t.call(this,e),this.connectable=i}return s(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var i=this.connection,s=t._connection;this.connection=null,!s||i&&s!==i||s.unsubscribe()}}else this.connection=null},e}(r.Subscriber)},xA5P:function(t,e,i){"use strict";var s=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},r=function(t){function e(){t.apply(this,arguments),this.actions=[],this.active=!1,this.scheduled=void 0}return s(e,t),e.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var i;this.active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}},e}(i("m4/a").Scheduler);e.AsyncScheduler=r},xDhC:function(t,e,i){"use strict";var s=i("4c1C"),r=i("u+1n");s.Observable.fromEventPattern=r.fromEventPattern},xE8I:function(t,e,i){"use strict";var s=i("3oOo");e.multicast=function(t,e){return function(i){var o;if(o="function"==typeof t?t:function(){return t},"function"==typeof e)return i.lift(new r(o,e));var n=Object.create(i,s.connectableObservableDescriptor);return n.source=i,n.subjectFactory=o,n}};var r=function(){function t(t,e){this.subjectFactory=t,this.selector=e}return t.prototype.call=function(t,e){var i=this.selector,s=this.subjectFactory(),r=i(s).subscribe(t);return r.add(e.subscribe(s)),r},t}();e.MulticastOperator=r},z6YP:function(t,e,i){"use strict";e.isScheduler=function(t){return t&&"function"==typeof t.schedule}}}]);