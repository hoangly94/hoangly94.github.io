(window.webpackJsonp=window.webpackJsonp||[]).push([["bottom-widgetbar"],{"3A7E":function(e,t,i){},Vg5g:function(e,t,i){"use strict";i.r(t),i.d(t,"Bottomwidgetbar",(function(){return r})),i("P5fv");var s=i("hY0g"),a=i.n(s),o=i("Vdly"),n=i("dwZ6"),h=i("ZzsE");i("3A7E"),i("i8AX");class r{constructor(e,t){this._inited=!1,this._minHeight=30,this._paddingTop=n.a,this.open=()=>{"minimized"===this._mode.value()&&this._mode.setValue("normal")},this.close=()=>{this._mode.setValue("minimized")},this.toggleMaximize=()=>{switch(this._mode.value()){case"minimized":case"normal":this._mode.setValue("maximized");break;case"maximized":this._mode.setValue("normal")}},this.toggleMinimize=()=>{switch(this._mode.value()){case"minimized":this.open();break;case"normal":case"maximized":this.close()}},this._mode=new a.a,this._isOverlap=new a.a,this._isVisible=new a.a,this._activeWidget=new a.a,this._widgets={},this._buttons={},this._widgetsProperties={},this._normalHeight=new a.a,this._actualHeight=new a.a,this._userSettings=t,this._options=e||{},this._config=e.config,this._enabledWidgets=(e&&e.widgets||[]).filter((e=>e&&Boolean(this._config[e]))),this._init(e)}activeWidget(){return this._activeWidget.readonly()}footerWidgetContainer(){return this._$footerWidgetContainer[0]}toggleWidget(e,t){return new Promise((i=>{"boolean"==typeof e?e?this.open():this.close():this.isWidgetEnabled(e)&&(t?this.open():this.activeWidget().value()===e&&"minimized"!==this.mode().value()?this.close():this.open(),this._activeWidget.setValue(e)),i()}))}getWidgetByName(e){return this._widgets[e]||null}getButtonByName(e){return this._buttons[e]||null}mode(){return this._mode.readonly()}isOverlap(){return this._isOverlap.readonly()}setNormalHeight(e){this._normalHeight.setValue(e)}destroy(){}isWidgetEnabled(e){return this._enabledWidgets.includes(e)}activateTradingTab(){return this.toggleWidget("paper_trading",!0).then((()=>{const e=this.getWidgetByName("paper_trading");e&&e.activate&&e.activate()}))}activateScriptEditorTab(e){this.toggleWidget("screener",!0).then((()=>{const t=this._config.scripteditor;t&&t.ctor.open(e)}))}turnOffMaximize(){"maximized"===this._mode.value()&&this.toggleMaximize()}enabledWidgets(){return this._enabledWidgets.map((e=>this._config[e]))}activeWidgetName(){return this._activeWidget.value()}isVisible(){return this._isVisible.readonly()}_init(e){if(!this._enabledWidgets.length||this._inited)return;this._createLayout($(this._options.resizerBridge.container.value()));const t=()=>{let e=0;switch(this._mode.value()){case"normal":e=this._normalHeight.value();break;case"maximized":e=this._resizerAvailHeight()}const t={min:Math.min(this._getPaddingBoxHeight(e),this._getPaddingBoxHeight(this._minHeight)),max:this._getPaddingBoxHeight(e)};this._options.resizerBridge.negotiateHeight(t)},i=()=>{if("minimized"!==this._mode.value()){const t=this._activeWidget.value();let i;if(this._$container.removeClass("js-hidden").css({height:this._actualHeight.value()}),this._$container.find(".bottom-widgetbar-content").addClass("js-hidden"),this._widgets[t]){const e=this._widgets[t];e&&e._$content&&(i=e._$content,i.removeClass("js-hidden"))}else{i=$(document.createElement("div")).attr("class","bottom-widgetbar-content "+t),i.appendTo(this._$container),this._initWidgetProperties(t);const s=new a.a;this._activeWidget.subscribe((e=>{s.setValue(e===t)}),{callWithLast:!0});const o=()=>{this.toggleWidget(t,!0)},n=this._config[t];if(n){const a=n.ctor;this._widgets[t]=new a({$body:i,container:i[0],bottomAreaContainer:this._$container[0],height:this._actualHeight,width:this._options.resizerBridge.width,bottomToolbarMode:this.mode(),visible:s.readonly(),properties:this._widgetsProperties[t],activate:o,chartWidgetCollection:e.chartWidgetCollection||null,originalStandalone:"screener"===t,backtestingStrategyDispatcher:this._options.backtestingStrategyDispatcher})}const h=this._widgets[t];h&&(h._$content=i,h.disabled&&h.disabled.subscribe((e=>{this._$loadingOverlay.toggleClass("js-hidden",!e)})))}}this._normalHeight.unsubscribe(t),this._normalHeight.subscribe(t),this._mode.unsubscribe(t),this._mode.subscribe(t),this._options.resizerBridge.availHeight.unsubscribe(t),this._options.resizerBridge.availHeight.subscribe(t),t(),this._save()};this._mode.subscribe(i),this._activeWidget.subscribe(i),this._normalHeight.subscribe((()=>{this._save()})),this._mode.subscribe((()=>{this._save()})),this._options.resizerBridge.height.subscribe((()=>{const e=this._options.resizerBridge.height.value(),t=Math.max(this._getContentBoxHeight(e),0);this._$container.css("height",t),this._actualHeight.setValue(t)}),{callWithLast:!0}),this._registerWidgets(),this._loadState(),this._subscribeCheckOverlap(),this._subscribeVisible(),this._inited=!0}_getContentBoxHeight(e){return e-this._paddingTop}_getPaddingBoxHeight(e){return e+this._paddingTop}_subscribeCheckOverlap(){this._checkOverlap(),this._actualHeight.subscribe((()=>{this._checkOverlap()})),this._mode.subscribe((()=>{this._checkOverlap()})),this._options.resizerBridge.availHeight.subscribe((()=>{this._checkOverlap()}))}_subscribeVisible(){this._checkVisible(),this._options.resizerBridge.visible.subscribe((()=>{this._checkVisible()})),this._options.resizerBridge.height.subscribe((()=>{this._checkVisible()})),this._options.resizerBridge.width.subscribe((()=>{this._checkVisible()}))}_createLayout(e){e[0].innerHTML="",this._$footerWidgetContainer=$("<div>").css({height:n.a}).appendTo(e),this._$container=$("<div>").attr("id","bottom-area").appendTo(e),$(document.createElement("div")).attr("class","bottom-widgetbar-handle").appendTo(this._$container).on("contextmenu",(e=>{e.preventDefault()})).on("mousedown touchstart",this._onLayoutResizeHandleMousedown.bind(this)),this._$loadingOverlay=$(document.createElement("div")).attr("class","bottom-widgetbar-loading-overlay js-hidden").appendTo(this._$container)}_onLayoutResizeHandleMousedown(e){if(e.defaultPrevented)return;e.preventDefault();const t=this._mode.value(),i=this._normalHeight.value(),s="minimized"===this._mode.value()?0:this._$container.height();let a;a=e.originalEvent.touches?e.originalEvent.touches[0].clientY:e.pageY;const o=e=>{let t;t=e.originalEvent.touches?e.originalEvent.touches[0].clientY:e.pageY;const i=t-a;let o="minimized"===this._mode.value(),n=s-i;n<=0?(n=s,o=!0):o=!1,n=Math.max(n,this._minHeight),isFinite(n)&&("minimized"===this._mode.value()!==o?o?(this._mode.setValue("minimized"),this.setNormalHeight(Math.max(s,this._minHeight))):(this._mode.setValue("normal"),this.setNormalHeight(n)):this._normalHeight.value()!==n&&(n>=this._getContentBoxHeight(this._resizerAvailHeight())?(this._mode.setValue("maximized"),this.setNormalHeight(s)):(this._mode.setValue("normal"),this.setNormalHeight(n))))},n=()=>{i>0&&"normal"!==this._mode.value()&&"normal"!==t&&this.setNormalHeight(i),$(document.documentElement).off("mousemove touchmove",o).off("mouseup touchend",n),this._save()};$(document.documentElement).on("mousemove touchmove",o).on("mouseup touchend",n)}_checkOverlap(){const e=this._getPaddingBoxHeight(this._actualHeight.value()),t=this._mode.value();this._isOverlap.setValue("maximized"===t||"normal"===t&&this._resizerAvailHeight()-e<=300)}_checkVisible(){const e=this._options.resizerBridge;this._isVisible.setValue(Boolean(e.visible.value()&&e.height.value()&&e.width.value()))}_resizerAvailHeight(){return this._options.resizerBridge.availHeight.value()}_initWidgetProperties(e){const t="bottom"+e+"widget",i=new a.a(o.getJSON(t,null));i.subscribe((e=>{e?o.setJSON(t,e):o.remove(t)})),this._widgetsProperties[e]=i}_loadState(){const e=this._userSettings;this._mode.setValue(e.mode),this._activeWidget.setValue(this.isWidgetEnabled(e.activeWidget)?e.activeWidget:this._enabledWidgets[0]),this.setNormalHeight(Math.max(e.height,this._minHeight))}_save(){this._inited&&Object(h.c)({activeWidget:this._activeWidget.value(),height:this._normalHeight.value(),mode:this._mode.value()})}_registerWidgets(){this._enabledWidgets.forEach((e=>{const t=this._config[e];t&&"function"==typeof t.onRegister&&t.onRegister.call(null,{activate:()=>{this.toggleWidget(e,!0)},name:e})}))}}},i8AX:function(e,t,i){}}]);